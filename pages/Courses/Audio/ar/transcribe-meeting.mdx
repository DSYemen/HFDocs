# ูุณุฎ ูุญุชูู ุงุฌุชูุงุน

ูู ูุฐุง ุงููุณู ุงูุฃุฎูุฑุ ุณูุณุชุฎุฏู ูููุฐุฌ Whisper ูุฅูุดุงุก ูุณุฎุฉ ูุญุฏูุซ ุฃู ุงุฌุชูุงุน ุจูู ูุชุญุฏุซูู ุฃู ุฃูุซุฑ. ุซู ุณููุฑูู ุจูููุฐุฌ *ุชุญุฏูุฏ ุงููุชุญุฏุซ* ููุชูุจุค ุจู "ูู ุชุญุฏุซ ููุชู". ูู ุฎูุงู ูุทุงุจูุฉ ุงูุทูุงุจุน ุงูุฒูููุฉ ูู ูุณุฎ Whisper ูุน ุงูุทูุงุจุน ุงูุฒูููุฉ ูู ูููุฐุฌ ุชุญุฏูุฏ ุงููุชุญุฏุซุ ูููููุง ุงูุชูุจุค ุจูุณุฎุฉ ูุงููุฉ ูู ุงูุงุฌุชูุงุน ูุน ุฃููุงุช ุจุฏุงูุฉ / ููุงูุฉ ูููุณูุฉ ุจุงููุงูู ููู ูุชุญุฏุซ. ูุฐู ูู ุงููุณุฎุฉ ุงูุฃุณุงุณูุฉ ูู ุฎุฏูุงุช ูุณุฎ ุงูุงุฌุชูุงุน ุงูุชู ูุฏ ุชููู ูุฏ ุฑุฃูุชูุง ุนุจุฑ ุงูุฅูุชุฑูุช ูู ููุงูุน ูุซู [Otter.ai](https://otter.ai) ูุบูุฑูุง:

<div class="flex justify-center">
     <img src="https://huggingface.co/datasets/huggingface-course/audio-course-images/resolve/main/diarization_transcription.png">
 </div>

## ุชุญุฏูุฏ ุงููุชุญุฏุซ

ุชุญุฏูุฏ ุงููุชุญุฏุซ (ุฃู diarisation) ูู ูููุฉ ุฃุฎุฐ ุฅุฏุฎุงู ุตูุชู ุบูุฑ ูุนููู ูุงูุชูุจุค ุจู "ูู ุชุญุฏุซ ููุชู".
ูุจุฐููุ ูููููุง ุงูุชูุจุค ุจุงูุทูุงุจุน ุงูุฒูููุฉ ูุจุฏุงูุฉ / ููุงูุฉ ูู ุฏูุฑ ูุชุญุฏุซุ ูุงูุชู ุชุชูุงูู ูุน ููุช ุจุฏุก ูู ูุชุญุฏุซ
ูู ุงูุชุญุฏุซ ูุนูุฏูุง ููุชูู.

๐ค Transformers ูุง ูุญุชูู ุญุงูููุง ุนูู ูููุฐุฌ ูุชุญุฏูุฏ ุงููุชุญุฏุซ ูุฏุฑุฌ ูู ุงูููุชุจุฉุ ูููู ููุงู ููุงุท ุชูุชูุด
ุนูู Hub ูููู ุงุณุชุฎุฏุงููุง ุจุณูููุฉ ูุณุจูุฉ. ูู ูุฐุง ุงููุซุงูุ ุณูุณุชุฎุฏู ูููุฐุฌ ุชุญุฏูุฏ ุงููุชุญุฏุซ ุงูููุฏุฑุจ ูุณุจููุง ูู
[pyannote.audio](https://github.com/pyannote/pyannote-audio). ุฏุนูุง ูุจุฏุฃ ููุซุจุช ุญุฒูุฉ pip:

```bash
pip install --upgrade pyannote.audio
```

ุฑุงุฆุน! ูุชู ุงุณุชุถุงูุฉ ุฃูุฒุงู ูุฐุง ุงููููุฐุฌ ุนูู Hugging Face Hub. ูููุตูู ุฅูููุงุ ูุฌุจ ุฃู ููุงูู ุฃููุงู ุนูู ุดุฑูุท ุงุณุชุฎุฏุงู ูููุฐุฌ ุชุญุฏูุฏ ุงููุชุญุฏุซ: [pyannote/speaker-diarization](https://huggingface.co/pyannote/speaker-diarization). ุซู ุดุฑูุท ุงุณุชุฎุฏุงู ูููุฐุฌ ุงูุชุฌุฒุฆุฉ: [pyannote/segmentation](https://huggingface.co/pyannote/segmentation).

ุจูุฌุฑุฏ ุงูุงูุชูุงุกุ ูููููุง ุชุญููู ุฎุท ุฃูุงุจูุจ ุชุญุฏูุฏ ุงููุชุญุฏุซ ุงูููุฏุฑุจ ูุณุจููุง ูุญูููุง ุนูู ุฌูุงุฒูุง:

```python
from pyannote.audio import Pipeline

diarization_pipeline = Pipeline.from_pretrained(
    "pyannote/speaker-diarization@2.1", use_auth_token=True
)
```

ุฏุนูุง ูุฌุฑุจู ุนูู ููู ุตูุชู ุนููุฉ! ููุฐุงุ ุณูุญูู ุนููุฉ ูู [LibriSpeech ASR](https://huggingface.co/datasets/librispeech_asr)
ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุชู ุชุชููู ูู ูุชุญุฏุซูู ูุฎุชูููู ุชู ุถูููุง ูุนูุง ูุฅุนุทุงุก ููู ุตูุชู ูุงุญุฏ:

```python
from datasets import load_dataset

concatenated_librispeech = load_dataset(
    "sanchit-gandhi/concatenated_librispeech", split="train", streaming=True
)
sample = next(iter(concatenated_librispeech))
```

ูููููุง ุงูุงุณุชูุงุน ุฅูู ุงูุตูุช ููุนุฑูุฉ ููู ูุจุฏู:

```python
from IPython.display import Audio

Audio(sample["audio"]["array"], rate=sample["audio"]["sampling_rate"])
```

ุฑุงุฆุน! ูููููุง ุณูุงุน ูุชุญุฏุซูู ูุฎุชูููู ุจูุถูุญุ ูุน ุงูุชูุงู ุชูุฑูุจู ุจุนุฏ 15 ุซุงููุฉ ูู ุจุฏุงูุฉ ุงูููุทุน. ุฏุนูุง ููุฑุฑ ูุฐุง ุงูููู ุงูุตูุชู
ุฅูู ูููุฐุฌ ุชุญุฏูุฏ ุงููุชุญุฏุซ ููุญุตูู ุนูู ุฃููุงุช ุจุฏุงูุฉ / ููุงูุฉ ุงููุชุญุฏุซ. ูุงุญุธ ุฃู pyannote.audio ูุชููุน ุฃู ูููู ุงูุฅุฏุฎุงู ุงูุตูุชู ุนุจุงุฑุฉ ุนู
ูุตูููุฉ PyTorch ูู ุงูุดูู `(channels, seq_len)`ุ ูุฐูู ูุญุชุงุฌ ุฅูู ุฅุฌุฑุงุก ูุฐุง ุงูุชุญููู ูุจู ุชุดุบูู ุงููููุฐุฌ:

```python
import torch

input_tensor = torch.from_numpy(sample["audio"]["array"][None, :]).float()
outputs = diarization_pipeline(
    {"waveform": input_tensor, "sample_rate": sample["audio"]["sampling_rate"]}
)

outputs.for_json()["content"]
```

```text
[{'segment': {'start': 0.4978125, 'end': 14.520937500000002},
  'track': 'B',
  'label': 'SPEAKER_01'},
 {'segment': {'start': 15.364687500000002, 'end': 21.3721875},
  'track': 'A',
  'label': 'SPEAKER_00'}]
```

ูุจุฏู ูุฐุง ุฌูุฏูุง! ูููููุง ุฃู ูุฑู ุฃู ุงููุชุญุฏุซ ุงูุฃูู ููุชููุน ุฃูู ูุชุญุฏุซ ุญุชู ุนูุงูุฉ 14.5 ุซุงููุฉุ ูุงููุชุญุฏุซ
ุงูุซุงูู ูู 15.4 ุซุงููุฉ ูุตุงุนุฏูุง. ุงูุขู ูุญุชุงุฌ ุฅูู ุงูุญุตูู ุนูู ุงููุณุฎุฉ!

## ูุณุฎ ุงูููุงู

ูููุฑุฉ ุงูุซุงูุซุฉ ูู ูุฐู ุงููุญุฏุฉุ ุณูุณุชุฎุฏู ูููุฐุฌ Whisper ููุธุงู ูุณุฎ ุงูููุงู ุงูุฎุงุต ุจูุง. ุนูู ูุฌู ุงูุชุญุฏูุฏุ ุณูุญูู ููุทุฉ ุชูุชูุด
[Whisper Base](https://huggingface.co/openai/whisper-base)ุ ุญูุซ ุฃููุง ุตุบูุฑุฉ ุจูุง ูููู ูููุญ ุณุฑุนุฉ ุงุณุชูุชุงุฌ ุฌูุฏุฉ
ูุน ุฏูุฉ ูุณุฎ ูุนูููุฉ. ููุง ูู ุงูุญุงู ุฏุงุฆููุงุ ููููู ุงุณุชุฎุฏุงู ุฃู ููุทุฉ ุชูุชูุด ููุชุนุฑู ุนูู ุงูููุงู
ุนูู [Hub](https://huggingface.co/models?pipeline_tag=automatic-speech-recognition&library=transformers&sort=trending)ุ
ุจูุง ูู ุฐูู Wav2Vec2ุ MMS ASR ุฃู ููุงุท ุชูุชูุด Whisper ุงูุฃุฎุฑู:

```python
from transformers import pipeline

asr_pipeline = pipeline(
    "automatic-speech-recognition",
    model="openai/whisper-base",
)
```

ุฏุนูุง ูุญุตู ุนูู ูุณุฎุฉ ูููุทุน ุงูุตูุช ูุฏููุงุ ูุน ุฅุนุงุฏุฉ ุฃููุงุช ุจุฏุงูุฉ / ููุงูุฉ ุงููุณุชูู ุงููุทุนู ุฃูุถูุง ุญุชู ูุนุฑู
ุฃููุงุช ุจุฏุงูุฉ / ููุงูุฉ ูู ูุทุนุฉ. ุณุชุชุฐูุฑ ูู ุงููุญุฏุฉ 5 ุฃููุง ุจุญุงุฌุฉ ุฅูู ุชูุฑูุฑ ุงูุญุฌุฉ
`return_timestamps=True` ูุชูุดูุท ูููุฉ ุงูุชูุจุค ุจุงูุทุงุจุน ุงูุฒููู ูู Whisper:

```python
asr_pipeline(
    sample["audio"].copy(),
    generate_kwargs={"max_new_tokens": 256},
    return_timestamps=True,
)
```

```text
{
    "text": " The second and importance is as follows. Sovereignty may be defined to be the right of making laws. In France, the king really exercises a portion of the sovereign power, since the laws have no weight. He was in a favored state of mind, owing to the blight his wife's action threatened to cast upon his entire future.",
    "chunks": [
        {"timestamp": (0.0, 3.56), "text": " The second and importance is as follows."},
        {
            "timestamp": (3.56, 7.84),
            "text": " Sovereignty may be defined to be the right of making laws.",
        },
        {
            "timestamp": (7.84, 13.88),
            "text": " In France, the king really exercises a portion of the sovereign power, since the laws have",
        },
        {"timestamp": (13.88, 15.48), "text": " no weight."},
        {
            "timestamp": (15.48, 19.44),
            "text": " He was in a favored state of mind, owing to the blight his wife's action threatened to",
        },
        {"timestamp": (19.44, 21.28), "text": " cast upon his entire future."},
    ],
}
```

ุญุณููุง! ูุฑู ุฃู ูู ูุทุนุฉ ูู ุงููุณุฎุฉ ููุง ููุช ุจุฏุงูุฉ ูููุงูุฉุ ูุน ุชุบููุฑ ุงููุชุญุฏุซูู ุนูุฏ ุนูุงูุฉ 15.48 ุซุงููุฉ
. ูููููุง ุงูุขู ูุทุงุจูุฉ ูุฐู ุงููุณุฎุฉ ูุน ุงูุทูุงุจุน ุงูุฒูููุฉ ูููุชุญุฏุซูู ุงูุชู ุญุตููุง ุนูููุง ูู ูููุฐุฌ ุชุญุฏูุฏ ุงููุชุญุฏุซ ููุญุตูู ุนูู ุงููุณุฎุฉ ุงูููุงุฆูุฉ.

## Speechbox

ููุญุตูู ุนูู ุงููุณุฎุฉ ุงูููุงุฆูุฉุ ุณูุญุงุฐู ุงูุทูุงุจุน ุงูุฒูููุฉ ูู ูููุฐุฌ ุชุญุฏูุฏ ุงููุชุญุฏุซ ูุน ุชูู ูู ูููุฐุฌ Whisper.
ุชููุน ูููุฐุฌ ุชุญุฏูุฏ ุงููุชุญุฏุซ ุงูุชูุงุก ุงููุชุญุฏุซ ุงูุฃูู ุนูุฏ 14.5 ุซุงููุฉุ ูุจุฏุก ุงููุชุญุฏุซ ุงูุซุงูู ุนูุฏ 15.4 ุซุงููุฉุ ูู ุญูู ุชููุน Whisper ุญุฏูุฏ ุงููุทุนุฉ ุนูุฏ
13.88ุ 15.48 ู 19.44 ุซุงููุฉ ุนูู ุงูุชูุงูู. ูุธุฑูุง ูุฃู ุงูุทูุงุจุน ุงูุฒูููุฉ ูู Whisper ูุง ุชุชุทุงุจู ุชูุงููุง ูุน ุชูู ุงูููุฌูุฏุฉ ูู
ูููุฐุฌ ุชุญุฏูุฏ ุงููุชุญุฏุซุ ูุญุชุงุฌ ุฅูู ุฅูุฌุงุฏ ุฃู ูู ูุฐู ุงูุญุฏูุฏ ุฃูุฑุจ ุฅูู 14.5 ู 15.4 ุซุงููุฉุ ูุชูุณูู ุงููุณุฎุฉ ุญุณุจ
ุงููุชุญุฏุซูู ููููุง ูุฐูู. ุนูู ูุฌู ุงูุชุญุฏูุฏุ ุณูุนุซุฑ ุนูู ุฃูุฑุจ ูุญุงุฐุงุฉ ุจูู ุชุญุฏูุฏ ุงููุชุญุฏุซ ููุณุฎุฉ ุงูุทูุงุจุน ุงูุฒูููุฉ ูู ุฎูุงู
ุชูููู ุงููุณุงูุฉ ุงููุทููุฉ ุจูู ุงูุงุซููู.

ูุญุณู ุงูุญุธุ ูููููุง ุงุณุชุฎุฏุงู ุญุฒูุฉ ๐ค Speechbox ูุฃุฏุงุก ูุฐุง ุงููุญุงุฐุงุฉ. ุฃููุงูุ ุฏุนูุง ูุซุจุช `speechbox` ูู
ุงูุฑุฆูุณู:

```bash
pip install git+https://github.com/huggingface/speechbox
```

ูููููุง ุงูุขู ุฅูุดุงุก ุฎุท ุฃูุงุจูุจ ุชุญุฏูุฏ ุงููุชุญุฏุซ ุจุงูุฅุถุงูุฉ ุฅูู ุฎุท ุฃูุงุจูุจ ุงููุณุฎุ ูู ุฎูุงู ุชูุฑูุฑ ูููุฐุฌ ุชุญุฏูุฏ ุงููุชุญุฏุซ ู
ูููุฐุฌ ASR ุฅูู ูุฆุฉ [`ASRDiarizationPipeline`](https://github.com/huggingface/speechbox/tree/main#asr-with-speaker-diarization):

```python
from speechbox import ASRDiarizationPipeline

pipeline = ASRDiarizationPipeline(
    asr_pipeline=asr_pipeline, diarization_pipeline=diarization_pipeline
)
```

<Tip>
    ููููู ุฃูุถูุง ุฅูุดุงุก <code>ASRDiarizationPipeline</code> ูุจุงุดุฑุฉ ูู ุงูููุฏุฑุจ ูุณุจููุง ูู ุฎูุงู ุชุญุฏูุฏ ูุนุฑู ุงููููุฐุฌ
    ููููุฐุฌ ASR ุนูู Hub:
    <p><code>pipeline = ASRDiarizationPipeline.from_pretrained("openai/whisper-base")</code></p>
</Tip>

ุฏุนูุง ููุฑุฑ ููู ุงูุตูุช ุฅูู ุฎุท ุงูุฃูุงุจูุจ ุงููุฑูุจ ููุฑู ูุง ุงูุฐู ุณูุญุตู ุนููู:

```python
pipeline(sample["audio"].copy())
```
```text
[{'speaker': 'SPEAKER_01',
  'text': ' ุงูููุทุฉ ุงูุซุงููุฉ ูุงูุฃูู ูู ููุง ููู. ูููู ุชุนุฑูู ุงูุณูุงุฏุฉ ุจุฃููุง ุงูุญู ูู ุณู ุงูููุงููู. ูู ูุฑูุณุงุ ููุงุฑุณ ุงูููู ุจุงููุนู ุฌุฒุกูุง ูู ุงูุณูุทุฉ ุงูุณูุงุฏูุฉุ ุญูุซ ูุง ุชุญูู ุงูููุงููู ุฃู ูุฒู.',
  'timestamp': (0.0, 15.48)},
 {'speaker': 'SPEAKER_00',
  'text': ' ูุงู ูู ุญุงูุฉ ุฐูููุฉ ููุถูุฉุ ุจุณุจุจ ุงููุงุฑุซุฉ ุงูุชู ูุฏุฏุช ุจูุง ุฒูุฌุชู ุจุฅููุงุก ุธูุงููุง ุนูู ูุณุชูุจูู ุจุฃูููู.',
  'timestamp': (15.48, 21.28)}]
```

ููุชุงุฒ! ุงููุชุญุฏุซ ุงูุฃูู ููุณู ุนูู ุฃูู ูุชุญุฏุซ ูู 0 ุฅูู 15.48 ุซุงููุฉุ ูุงููุชุญุฏุซ ุงูุซุงูู ูู 15.48 ุฅูู 21.28 ุซุงููุฉุ
ูุน ุงููุตูุต ุงูููุงุจูุฉ ููู ููููุง.

ูููููุง ุชูุณูู ุงูุทูุงุจุน ุงูุฒูููุฉ ุจุดูู ุฃูุถู ููููุงู ูู ุฎูุงู ุชุญุฏูุฏ ุฏุงูุชูู ูุณุงุนุฏุชูู. ุงูุฃููู ุชุญูู ุฒูุฌูุง ูู ุงูุทูุงุจุน ุงูุฒูููุฉ ุฅูู ุณูุณูุฉุ ููุฑุจุฉ ุฅูู ุนุฏุฏ ูุญุฏุฏ ูู ุงูููุงุฒู ุงูุนุดุฑูุฉ. ูุงูุซุงููุฉ ุชุฌูุน ูุนูููุงุช ุงููุชุญุฏุซ ูุงูุทุงุจุน ุงูุฒููู ูุงููุต
ูู ุณุทุฑ ูุงุญุฏุ ูุชูุณู ูู ูุชุญุฏุซ ุฅูู ุณุทุฑ ุฎุงุต ุจู ูุณูููุฉ ุงููุฑุงุกุฉ:

```python
def tuple_to_string(start_end_tuple, ndigits=1):
    return str((round(start_end_tuple[0], ndigits), round(start_end_tuple[1], ndigits)))


def format_as_transcription(raw_segments):
    return "\n\n".join(
        [
            chunk["speaker"] + " " + tuple_to_string(chunk["timestamp"]) + chunk["text"]
            for chunk in raw_segments
        ]
    )
```

ุฏุนููุง ูุนูุฏ ุชุดุบูู ุฎุท ุงูุฃูุงุจูุจุ ูุฐู ุงููุฑุฉ ุชูุณูู ุงููุณุฎ ููููุง ููุฏุงูุฉ ุงูุชู ุญุฏุฏูุงูุง ููุชู:
```python
outputs = pipeline(sample["audio"].copy())

format_as_transcription(outputs)
```

```text
SPEAKER_01 (0.0, 15.5) ุงูููุทุฉ ุงูุซุงููุฉ ูุงูุฃูู ูู ููุง ููู. ูููู ุชุนุฑูู ุงูุณูุงุฏุฉ ุจุฃููุง ุงูุญู ูู ุณู ุงูููุงููู.
ูู ูุฑูุณุงุ ููุงุฑุณ ุงูููู ุจุงููุนู ุฌุฒุกูุง ูู ุงูุณูุทุฉ ุงูุณูุงุฏูุฉุ ุญูุซ ูุง ุชุญูู ุงูููุงููู ุฃู ูุฒู.

SPEAKER_00 (15.5, 21.3) ูุงู ูู ุญุงูุฉ ุฐูููุฉ ููุถูุฉุ ุจุณุจุจ ุงููุงุฑุซุฉ ุงูุชู ูุฏุฏุช ุจูุง ุฒูุฌุชู ุจุฅููุงุก ุธูุงููุง ุนูู
ูุณุชูุจูู ุจุฃูููู.
```

ููุง ุจูุง! ุจูุฐุงุ ูููุง ุจุชูุณูู ูุชุณุฌูู ุงูุตูุช ุงููุฏุฎู ุงูุฎุงุต ุจูุง ูุนุงุฏูุง ุจูุตูุต ููุณูุฉ ุญุณุจ ุงููุชุญุฏุซ.
ุนูู ุงูุฑุบู ูู ุฃู ุฎูุงุฑุฒููุฉ ุงููุณุงูุฉ ุงูุฏููุง ูููุงุกูุฉ ุงูุทูุงุจุน ุงูุฒูููุฉ ุงูููุณูุฉ ูุงูุทูุงุจุน ุงูุฒูููุฉ ุงููุณุฌูุฉ ุจุณูุทุฉุ ุฅูุง ุฃููุง
ุชุนูู ุจุดูู ุฌูุฏ ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ. ุฅุฐุง ููุช ุชุฑุบุจ ูู ุงุณุชูุดุงู ุทุฑู ุฃูุซุฑ ุชูุฏููุง ูุฏูุฌ ุงูุทูุงุจุน ุงูุฒูููุฉุ
ุฑูุฒ ุงููุตุฏุฑ ูู `ASRDiarizationPipeline` ูู ููุงู ุฌูุฏ ููุจุฏุก: [speechbox/diarize.py](https://github.com/huggingface/speechbox/blob/96d2d1a180252d92263f862a1cd25a48860f1aed/src/speechbox/diarize.py#L12)