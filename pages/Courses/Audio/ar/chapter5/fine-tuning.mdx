# ุถุจุท ูููุฐุฌ ุงูุชุนุฑู ุงูุชููุงุฆู ุนูู ุงูููุงู ASR

ูู ูุฐุง ุงููุณูุ ุณููุฏู ุฏููููุง ุฎุทูุฉ ุจุฎุทูุฉ ุญูู ุถุจุท ูููุฐุฌ Whisper ููุชุนุฑู ุนูู ุงูููุงู ูู ูุฌููุนุฉ ุจูุงูุงุช Common Voice 13. ุณูุณุชุฎุฏู ุงูุฅุตุฏุงุฑ "ุงูุตุบูุฑ" ูู ุงููููุฐุฌ ููุฌููุนุฉ ุจูุงูุงุช ุฎูููุฉ ูุณุจููุงุ ููุง ูุชูุญ ูู ุชุดุบูู ุงูุถุจุท ุงูุฏููู ุจุณุฑุนุฉ ุฅูู ุญุฏ ูุง ุนูู ุฃู ูุญุฏุฉ ูุนุงูุฌุฉ ุฑุณูููุฉ GPU ุจุณุนุฉ 16 ุฌูุฌุงุจุงูุช ุฃู ุฃูุซุฑ ูุน ูุชุทูุจุงุช ูุณุงุญุฉ ููุฎูุถุฉ ุนูู ุงููุฑุตุ ูุซู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช GPU ุจุณุนุฉ 16 ุฌูุฌุงุจุงูุช T4 ุงูููุฏูุฉ ูู ุงููุณุชูู ุงููุฌุงูู ูู Google Colab.

ุฅุฐุง ูุงู ูุฏูู ูุญุฏุฉ ูุนุงูุฌุฉ ุฑุณูููุฉ GPU ุฃุตุบุฑ ุฃู ูุงุฌูุช ูุดุงูู ูู ุงูุฐุงูุฑุฉ ุฃุซูุงุก ุงูุชุฏุฑูุจุ ููููู ุงุชุจุงุน ุงูุงูุชุฑุงุญุงุช ุงูููุฏูุฉ ูุชูููู ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ. ุนูู ุงูุนูุณุ ุฅุฐุง ูุงู ูุฏูู ุฅููุงููุฉ ุงููุตูู ุฅูู ูุญุฏุฉ ูุนุงูุฌุฉ ุฑุณูููุฉ GPU ุฃูุจุฑุ ููููู ุชุนุฏูู ุญุฌุฌ ุงูุชุฏุฑูุจ ูุฒูุงุฏุฉ ุงูุฅูุชุงุฌูุฉ ุฅูู ุงูุญุฏ ุงูุฃูุตู. ูุจุงูุชุงููุ ูุฐุง ุงูุฏููู ูุชุงุญ ุจุบุถ ุงููุธุฑ ุนู ููุงุตูุงุช ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช GPU ุงูุฎุงุตุฉ ุจู!

ูุจุงููุซูุ ููุถุญ ูุฐุง ุงูุฏููู ููููุฉ ุถุจุท ูููุฐุฌ Whisper ููุบุฉ ุงูุฏูููููุฉ. ููุน ุฐููุ ูุฅู ุงูุฎุทูุงุช ุงููุดูููุฉ ููุง ุนุงูุฉ ูุฃู ูุบุฉ ูู ูุฌููุนุฉ ุจูุงูุงุช Common Voiceุ ูุจุดูู ุฃูุซุฑ ุนููููุฉ ูุฃู ูุฌููุนุฉ ุจูุงูุงุช ASR ุนูู Hugging Face Hub. ููููู ุชุนุฏูู ุงูููุฏ ุจุณุฑุนุฉ ููุชุญููู ุฅูู ูุบุฉ ูู ุงุฎุชูุงุฑู ูุถุจุท ูููุฐุฌ Whisper ุจูุบุชู ุงูุฃู ๐

ุญุณูุง! ุงูุขู ุจุนุฏ ุฃู ุงูุชูููุง ูู ุฐููุ ุฏุนูุง ูุจุฏุฃ ููุทูู ุฎุท ุฃูุงุจูุจ ุงูุถุจุท ุงูุฏููู ูุฏููุง!

## ุฅุนุฏุงุฏ ุงูุจูุฆุฉ

ููุตุญู ุจุดุฏุฉ ุจุชุญููู ููุงุท ุชูุชูุด ุงููููุฐุฌ ูุจุงุดุฑุฉ ุฅูู [Hugging Face Hub](https://huggingface.co/) ุฃุซูุงุก ุงูุชุฏุฑูุจ.
ูููุฑ ุงููุฑูุฒ:
- ุงูุชุญูู ูู ุงูุฅุตุฏุงุฑ ุงููุชูุงูู: ููููู ุงูุชุฃูุฏ ูู ุนุฏู ููุฏุงู ุฃู ููุทุฉ ุชูุชูุด ูููููุฐุฌ ุฃุซูุงุก ุงูุชุฏุฑูุจ.
- ุณุฌูุงุช Tensorboard: ุชุชุจุน ุงูููุงููุณ ุงููููุฉ ุนูู ูุฏุงุฑ ุงูุชุฏุฑูุจ.
- ุจุทุงูุงุช ุงููููุฐุฌ: ุชูุซูู ูุง ููุนูู ุงููููุฐุฌ ูุงุณุชุฎุฏุงูุงุชู ุงูููุตูุฏุฉ.
- ุงููุฌุชูุน: ุทุฑููุฉ ุณููุฉ ูููุดุงุฑูุฉ ูุงูุชุนุงูู ูุน ุงููุฌุชูุน! ๐ค

ุฑุจุท ุงูุฏูุชุฑ ุจุงููุฑูุฒ ุฃูุฑ ุจุณูุท - ููู ูุชุทูุจ ููุท ุฅุฏุฎุงู ุฑูุฒ ุงููุตุงุฏูุฉ ุงูุฎุงุต ุจู ุนูุฏ ุงููุทุงูุจุฉ.
ุงุจุญุซ ุนู ุฑูุฒ ูุตุงุฏูุฉ ุงููุฑูุฒ ุงูุฎุงุต ุจู [ููุง](https://huggingface.co/settings/tokens) ูุฃุฏุฎูู ุนูุฏ ุงููุทุงูุจุฉ:

```python
from huggingface_hub import notebook_login

notebook_login()
```

**ุงูุฅุฎุฑุงุฌ:**
```bash
ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ
ุชู ุญูุธ ุงูุฑูุฒ ุงูุฎุงุต ุจู ูู /root/.huggingface/token
```

## ุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช

ุชุญุชูู [Common Voice 13](https://huggingface.co/datasets/mozilla-foundation/common_voice_13_0) ุนูู ูุง ููุฑุจ ูู ุนุดุฑ
ุณุงุนุงุช ูู ุงูุจูุงูุงุช ุงููุณูุงุฉ ุจูุบุฉ ุงูุฏูููููุฉุ ุซูุงุซ ูููุง ูู ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ ุงููุญุฌูุฒุฉ. ูุฐู ุจูุงูุงุช ููููุฉ ููุบุงูุฉ ููุถุจุท ุงูุฏูููุ ูุฐูู
ุณูุนุชูุฏ ุนูู ุงูุงุณุชูุงุฏุฉ ูู ุงููุนุฑูุฉ ูุชุนุฏุฏุฉ ุงููุบุงุช ASR ุงูุดุงููุฉ ุงูุชู ุงูุชุณุจูุง Whisper ุฃุซูุงุก ุงูุชุฏุฑูุจ ุงููุณุจู ููุบุฉ ุงูุฏูููููุฉ ููุฎูุถุฉ ุงูููุงุฑุฏ.

ุจุงุณุชุฎุฏุงู ๐ค Datasetsุ ูููู ุชูุฒูู ุงูุจูุงูุงุช ูุฅุนุฏุงุฏูุง ุจุณูุทูุง ููุบุงูุฉ. ูููููุง ุชูุฒูู ูุฅุนุฏุงุฏ ุชูุณููุงุช Common Voice 13 ูู ุณุทุฑ ูุงุญุฏ ูู ุงูููุฏ. ูุธุฑูุง ูุฃู ูุบุฉ ุงูุฏูููููุฉ ููุฎูุถุฉ ุงูููุงุฑุฏ ููุบุงูุฉุ ูุณูููู ุจุฏูุฌ ุงูุชูุณููุงุช `train` ู`validation`
ูุฅุนุทุงุก ูุง ููุฑุจ ูู ุณุจุน ุณุงุนุงุช ูู ุจูุงูุงุช ุงูุชุฏุฑูุจ. ุณูุณุชุฎุฏู ุซูุงุซ ุณุงุนุงุช ูู ุจูุงูุงุช `test` ููุฌููุนุฉ ุงุฎุชุจุงุฑ ูุญุฌูุฒุฉ ูุฏููุง:

```python
from datasets import load_dataset, DatasetDict

common_voice = DatasetDict()

common_voice["train"] = load_dataset(
    "mozilla-foundation/common_voice_13_0", "dv", split="train+validation"
)
common_voice["test"] = load_dataset(
    "mozilla-foundation/common_voice_13_0", "dv", split="test"
)

print(common_voice)
```

**ุงูุฅุฎุฑุงุฌ:**
```
DatasetDict({
    train: Dataset({
        features: ['client_id', 'path', 'audio', 'sentence', 'up_votes', 'down_votes', 'age', 'gender', 'accent', 'locale', 'segment', 'variant'],
        num_rows: 4904
    })
    test: Dataset({
        features: ['client_id', 'path', 'audio', 'sentence', 'up_votes', 'down_votes', 'age', 'gender', 'accent', 'locale', 'segment', 'variant'],
        num_rows: 2212
    })
})
```

<Tip>
    ููููู ุชุบููุฑ ูุนุฑู ุงููุบุฉ ูู `"dv"` ุฅูู ูุนุฑู ูุบุฉ ูู ุงุฎุชูุงุฑู. ููุดุงูุฏุฉ ุฌููุน ุงููุบุงุช ุงููุญุชููุฉ
    ูู Common Voice 13ุ ุชุญูู ูู ุจุทุงูุฉ ูุฌููุนุฉ ุงูุจูุงูุงุช ุนูู Hugging Face Hub: https://huggingface.co/datasets/mozilla-foundation/common_voice_13_0
</Tip>

ุชููุฑ ูุนุธู ูุฌููุนุงุช ุจูุงูุงุช ASR ุนููุงุช ุตูุชูุฉ ููุฅุฏุฎุงู (`audio`) ูุงููุต ุงูููููู ุงูููุงุจู (`sentence`).
ุชุญุชูู Common Voice ุนูู ูุนูููุงุช ุฅุถุงููุฉ ููุจูุงูุงุช ุงููุตููุฉุ ูุซู `accent` ู`locale`ุ ูุงูุชู ูููููุง ุชุฌุงูููุง ูู ASR.
ูุฌุนู ุงูุฏูุชุฑ ุนุงููุง ูุฏุฑ ุงูุฅููุงูุ ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ููุท ุงูุตูุช ุงููุฏุฎู ูุงููุต ุงูููููู ููุถุจุท ุงูุฏูููุ
ููุชุฎูุต ูู ูุนูููุงุช ุงูุจูุงูุงุช ุงููุตููุฉ ุงูุฅุถุงููุฉ:

```python
common_voice = common_voice.select_columns(["audio", "sentence"])
```

## ูุณุชุฎุฑุฌ ุงูููุฒุงุชุ ูุงููุญูู ุงูุฑูุฒูุ ูุงููุนุงูุฌ

ูููู ุชูููู ุฎุท ุฃูุงุจูุจ ASR ุฅูู ุซูุงุซ ูุฑุงุญู:

1. ูุณุชุฎุฑุฌ ุงูููุฒุงุช ุงูุฐู ูููู ุจูุนุงูุฌุฉ ูุณุจูุฉ ููุฅุฏุฎุงูุงุช ุงูุตูุชูุฉ ุงูุฎุงู ุฅูู ูุฎุทุทุงุช ุทูููุฉ ููุฌุงุฑูุชููุฉ
2. ุงููููุฐุฌ ุงูุฐู ูููู ุจุชุฎุทูุท ุงูุชุณูุณู ุฅูู ุงูุชุณูุณู
3. ุงููุญูู ุงูุฑูุฒู ุงูุฐู ูููู ุจูุนุงูุฌุฉ ูุง ุจุนุฏ ุงูุชูุจุค ููุฑููุฒ ุฅูู ูุต

ูู ๐ค Transformersุ ูุฑุชุจุท ูููุฐุฌ Whisper ุจูุณุชุฎุฑุฌ ููุฒุงุช ููุญูู ุฑูุฒูุ ูุณูู [WhisperFeatureExtractor](https://huggingface.co/docs/transformers/main/model_doc/whisper#transformers.WhisperFeatureExtractor) ู [WhisperTokenizer](https://huggingface.co/docs/transformers/main/model_doc/whisper#transformers.WhisperTokenizer)
ุนูู ุงูุชูุงูู. ูุชุณููู ุงูุฃููุฑุ ูุชู ุชุบููู ูุฐูู ุงููุงุฆููู ุชุญุช ูุฆุฉ ูุงุญุฏุฉุ ุชุณูู [WhisperProcessor](https://huggingface.co/docs/transformers/model_doc/whisper#transformers.WhisperProcessor).
ูููููุง ุงุณุชุฏุนุงุก WhisperProcessor ูุฃุฏุงุก ูู ูู ุงููุนุงูุฌุฉ ุงููุณุจูุฉ ููุตูุช ููุนุงูุฌุฉ ุงูุฑููุฒ ุงููุตูุฉ ุจุนุฏ ุงูุชูุจุค. ุนูุฏ ุงูููุงู ุจุฐููุ
ูุญุชุงุฌ ููุท ุฅูู ุชุชุจุน ูุงุฆููู ุฃุซูุงุก ุงูุชุฏุฑูุจ: ุงููุนุงูุฌ ูุงููููุฐุฌ.

ุนูุฏ ุฅุฌุฑุงุก ุงูุถุจุท ุงูุฏููู ูุชุนุฏุฏ ุงููุบุงุชุ ูุญุชุงุฌ ุฅูู ุชุนููู `"language"` ู`"task"` ุนูุฏ ุฅูุดุงุก ุงููุนุงูุฌ.
ูุฌุจ ุชุนููู `"language"` ุฅูู ูุบุฉ ุงูุตูุช ุงููุตุฏุฑุ ูุงููููุฉ ุฅูู `"transcribe"` ููุชุนุฑู ุนูู ุงูููุงู ุฃู
`"translate"` ููุชุฑุฌูุฉ ุงูููุงููุฉ. ุชุนุฏู ูุฐู ุงูุญุฌุฌ ุณููู ุงููุญูู ุงูุฑูุฒูุ ููุฌุจ ุชุนููููุง ุจุดูู ุตุญูุญ
ูุถูุงู ุชุฑููุฒ ุงูุนูุงูุงุช ุงููุณุชูุฏูุฉ ุจุดูู ุตุญูุญ.

ูููููุง ุฑุคูุฉ ุฌููุน ุงููุบุงุช ุงููุญุชููุฉ ุงูุชู ูุฏุนููุง Whisper ุนู ุทุฑูู ุงุณุชูุฑุงุฏ ูุงุฆูุฉ ุงููุบุงุช:

```python
from transformers.models.whisper.tokenization_whisper import TO_LANGUAGE_CODE

TO_LANGUAGE_CODE
```

ุฅุฐุง ููุช ุจุงูุชูุฑูุฑ ุฎูุงู ูุฐู ุงููุงุฆูุฉุ ูุณุชูุงุญุธ ูุฌูุฏ ุงูุนุฏูุฏ ูู ุงููุบุงุชุ ูููู ุงูุฏูููููุฉ ูู ูุงุญุฏุฉ ูู ุงููููู ุงูุชู ูุง ุชูุฌุฏ!
ูุฐุง ูุนูู ุฃู Whisper ูู ูุชู ุชุฏุฑูุจู ูุณุจููุง ุนูู ุงูุฏูููููุฉ. ููุน ุฐููุ ูุฐุง ูุง ูุนูู ุฃููุง ูุง ูุณุชุทูุน ุถุจุท Whisper ุนูููุง.
ุนูุฏ ุงูููุงู ุจุฐููุ ุณูุนูู Whisper ูุบุฉ ุฌุฏูุฏุฉุ ููู ูุบุฉ ูุง ุชุฏุนููุง ููุทุฉ ุงูุชูุชูุด ุงููุฏุฑุจุฉ ูุณุจููุง. ูุฐุง ุฑุงุฆุนุ ุฃููุณ ูุฐูู!

ุนูุฏ ุถุจุท Whisper ุนูู ูุบุฉ ุฌุฏูุฏุฉุ ูููู ุจุนูู ุฌูุฏ ูู ุงูุงุณุชูุงุฏุฉ ูู ูุนุฑูุชู ุจุงููุบุงุช ุงูู 96 ุงูุฃุฎุฑู
ุงูุชู ุชู ุชุฏุฑูุจู ุนูููุง ูุณุจููุง. ุจุดูู ุนุงูุ ุณุชููู ุฌููุน ุงููุบุงุช ุงูุญุฏูุซุฉ ูุชุดุงุจูุฉ ูุบููุงู ูุน ูุงุญุฏุฉ ุนูู ุงูุฃูู ูู
ุงููุบุงุช ุงูู 96 ุงูุชู ูุนุฑููุง Whisper ุจุงููุนูุ ูุฐูู ุณููุน ุชุญุช ูุฐุง ุงููููุฐุฌ ูู ุชูุซูู ุงููุนุฑูุฉ ุนุจุฑ ุงููุบุงุช.

ูุง ูุญุชุงุฌ ุฅูู ูุนูู ูุถุจุท Whisper ุนูู ูุบุฉ ุฌุฏูุฏุฉ ูู ุฅูุฌุงุฏ ุงููุบุฉ **ุงูุฃูุซุฑ ุชุดุงุจููุง** ุงูุชู ุชู ุชุฏุฑูุจ Whisper ุนูููุง ูุณุจููุง. ุชูุต ููุงูุฉ ููููุจูุฏูุง ููุบุฉ ุงูุฏูููููุฉ ุนูู ุฃู ุงูุฏูููููุฉ ูุฑุชุจุทุฉ ุงุฑุชุจุงุทูุง ูุซูููุง ุจูุบุฉ ุงูุณููุงููุฉ ูู ุณุฑููุงููุง.
ุฅุฐุง ุชุญูููุง ูู ุฑููุฒ ุงููุบุงุช ูุฑุฉ ุฃุฎุฑูุ ูููููุง ุฃู ูุฑู ุฃู ุงูุณููุงููุฉ ููุฌูุฏุฉ ูู ูุฌููุนุฉ ูุบุงุช Whisperุ
ูุฐูู ูููููุง ุชุนููู ุญุฌุฉ ุงููุบุฉ ุงูุฎุงุตุฉ ุจูุง ุจุฃูุงู ุฅูู `"sinhalese"`.

ุญุณูุง! ุณูููู ุจุชุญููู ุงููุนุงูุฌ ุงูุฎุงุต ุจูุง ูู ููุทุฉ ุงูุชูุชูุด ุงููุฏุฑุจุฉ ูุณุจููุงุ ูุชุนููู ุงููุบุฉ ุฅูู `"sinhalese"` ูุงููููุฉ ุฅูู `"transcribe"`
ููุง ูู ููุถุญ ุฃุนูุงู:

```python
from transformers import WhisperProcessor

processor = WhisperProcessor.from_pretrained(
    "openai/whisper-small", language="sinhalese", task="transcribe"
)
```

ูู ุงูุฌุฏูุฑ ุจุงูุชูุฑุงุฑ ุฃูู ูู ูุนุธู ุงูุธุฑููุ ุณุชุฌุฏ ุฃู ุงููุบุฉ ุงูุชู ุชุฑูุฏ ุถุจุทูุง ููุฌูุฏุฉ ูู ูุฌููุนุฉ
ูุบุงุช ุงูุชุฏุฑูุจ ุงููุณุจูุ ููู ูุฐู ุงูุญุงูุฉ ููููู ุจุจุณุงุทุฉ ุชุนููู ุงููุบุฉ ูุจุงุดุฑุฉ ููุบุฉ ุงูุตูุช ุงููุตุฏุฑ! ูุงุญุธ ุฃู
ูุฌุจ ุญุฐู ููุชุง ุงูุญุฌุชูู ููุถุจุท ุงูุฏููู ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ููุทุ ุญูุซ ููุฌุฏ ุฎูุงุฑ ูุงุญุฏ ููุท ููุบุฉ
(`English`) ูุงููููุฉ (`transcribe`).

## ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูุณุจููุง

ุฏุนูุง ูููู ูุธุฑุฉ ุนูู ููุฒุงุช ูุฌููุนุฉ ุงูุจูุงูุงุช. ุงูุชุจู ุจุดูู ุฎุงุต ุฅูู ุนููุฏ `"audio"` - ููุถุญ ูุฐุง ูุนุฏู ุฃุฎุฐ ุงูุนููุงุช
ููุฅุฏุฎุงูุงุช ุงูุตูุชูุฉ ูุฏููุง:

```python
common_voice["train"].features
```
**ุงูุฅุฎุฑุงุฌ:**
```
{'audio': Audio(sampling_rate=48000, mono=True, decode=True, id=None),
 'sentence': Value(dtype='string', id=None)}
 ```

ูุธุฑูุง ูุฃู ุงูุตูุช ุงููุฏุฎู ูุฏููุง ุชู ุฃุฎุฐ ุนููุงุช ููู ุจูุนุฏู 48 ูููู ูุฑุชุฒุ ูุฅููุง ุจุญุงุฌุฉ ุฅูู _ุชุฎููุถ ูุนุฏู ุงูุนููุงุช_ ุฅูู 16 ูููู ูุฑุชุฒ ูุจู ุชูุฑูุฑู ุฅูู ูุณุชุฎูุต ููุฒุฉ Whisperุ ุญูุซ ุฃู 16 ูููู ูุฑุชุฒ ูู ูุนุฏู ุฃุฎุฐ ุงูุนููุงุช ุงููุชููุน ูู ูุจู ูููุฐุฌ Whisper.

ุณูููู ุจุถุจุท ุงููุฏุฎูุงุช ุงูุตูุชูุฉ ุฅูู ูุนุฏู ุฃุฎุฐ ุงูุนููุงุช ุงูุตุญูุญ ุจุงุณุชุฎุฏุงู ุทุฑููุฉ [`cast_column`](https://huggingface.co/docs/datasets/main/en/package_reference/main_classes#datasets.Dataset.cast_column)
ููุจูุงูุงุช. ูุฐู ุงูุนูููุฉ ูุง ุชุบูุฑ ุงูุตูุช ูู ููุงููุ ูููููุง ุชุดูุฑ ุฅูู ูุฌููุนุงุช ุงูุจูุงูุงุช ูุฅุนุงุฏุฉ ุฃุฎุฐ ุนููุงุช ูู ุงูุนููุงุช ุงูุตูุชูุฉ
ุนูุฏ ุชุญููููุง:

```python
from datasets import Audio

sampling_rate = processor.feature_extractor.sampling_rate
common_voice = common_voice.cast_column("audio", Audio(sampling_rate=sampling_rate))
```

ุงูุขู ูููููุง ูุชุงุจุฉ ุฏุงูุฉ ูุฅุนุฏุงุฏ ุจูุงูุงุชูุง ุฌุงูุฒุฉ ูููููุฐุฌ:

1. ูููู ุจุชุญููู ูุฅุนุงุฏุฉ ุฃุฎุฐ ุนููุงุช ูู ุงูุจูุงูุงุช ุงูุตูุชูุฉ ุนูู ุฃุณุงุณ ุนููุฉ ุชูู ุงูุฃุฎุฑู ูู ุฎูุงู ุงุณุชุฏุนุงุก `sample["audio"]`. ููุง ุชู ุดุฑุญู ุฃุนูุงูุ ๐ค Datasets ุชููู ุจุฃู ุนูููุงุช ุฅุนุงุฏุฉ ุฃุฎุฐ ุนููุงุช ุถุฑูุฑูุฉ ุฃุซูุงุก ุงูุชูููุฐ.
2. ูุณุชุฎุฏู ูุณุชุฎูุต ุงูููุฒุฉ ูุญุณุงุจ ููุฒุงุช ูุฏุฎูุงุช ูุฎุทุท ููู ุงูููุบุงุฑูุชูู ูู ูุตูููุฉ ุงูุตูุช ุฃุญุงุฏูุฉ ุงูุจุนุฏ ูุฏููุง.
3. ูููู ุจุชุฑููุฒ ุงููุตูุต ุฅูู ูุนุฑูุงุช ุงูุนูุงูุงุช ูู ุฎูุงู ุงุณุชุฎุฏุงู ุงูุฑูุฒ ุงููููุฒ.

```python
def prepare_dataset(example):
    audio = example["audio"]

    example = processor(
        audio=audio["array"],
        sampling_rate=audio["sampling_rate"],
        text=example["sentence"],
    )

    # ุญุณุงุจ ุทูู ุงููุฏุฎูุงุช ููุนููุฉ ุงูุตูุชูุฉ ุจุงูุซูุงูู
    example["input_length"] = len(audio["array"]) / audio["sampling_rate"]

    return example
```

ูููููุง ุชุทุจูู ุฏุงูุฉ ุฅุนุฏุงุฏ ุงูุจูุงูุงุช ุนูู ุฌููุน ุฃูุซูุฉ ุงูุชุฏุฑูุจ ูุฏููุง ุจุงุณุชุฎุฏุงู ุทุฑููุฉ `.map` ููุฌููุนุงุช ุงูุจูุงูุงุช ๐ค. ุณูููู
ุจุฅุฒุงูุฉ ุงูุฃุนูุฏุฉ ูู ุจูุงูุงุช ุงูุชุฏุฑูุจ ุงูุฎุงู (ุงูุตูุช ูุงููุต)ุ ุชุงุฑููู ููุท ุงูุฃุนูุฏุฉ ุงูุชู ุชุนูุฏูุง
ุฏุงูุฉ `prepare_dataset`:

```python
common_voice = common_voice.map(
    prepare_dataset, remove_columns=common_voice.column_names["train"], num_proc=1
)
```

ุฃุฎูุฑูุงุ ูููู ุจุชุตููุฉ ุฃู ุจูุงูุงุช ุชุฏุฑูุจ ุจุนููุงุช ุตูุชูุฉ ุฃุทูู ูู 30 ุซุงููุฉ. ูุฅูุง ูุฅู ูุฐู ุงูุนููุงุช ุณูุชู ุชูุทูุนูุง ุจูุงุณุทุฉ
ูุณุชุฎูุต ููุฒุฉ Whisper ููุง ูุฏ ูุคุซุฑ ุนูู ุงุณุชูุฑุงุฑ ุงูุชุฏุฑูุจ. ูุญู ูุญุฏุฏ ุฏุงูุฉ ุชุนูุฏ `True` ููุนููุงุช
ุงูุชู ุชูู ุนู 30 ุซุงููุฉุ ู `False` ูุชูู ุงูุชู ุชููู ุฃุทูู:

```python
max_input_length = 30.0


def is_audio_in_length_range(length):
    return length < max_input_length
```

ูุทุจู ุฏุงูุฉ ุงูุชุตููุฉ ุงูุฎุงุตุฉ ุจูุง ุนูู ุฌููุน ุนููุงุช ูุฌููุนุฉ ุจูุงูุงุช ุงูุชุฏุฑูุจ ูุฏููุง ูู ุฎูุงู ุทุฑููุฉ `.filter` ููุฌููุนุงุช ุงูุจูุงูุงุช ๐ค:

```python
common_voice["train"] = common_voice["train"].filter(
    is_audio_in_length_range,
    input_columns=["input_length"],
)
```

ุฏุนูุง ูุชุญูู ูู ููุฏุงุฑ ุจูุงูุงุช ุงูุชุฏุฑูุจ ุงูุชู ูููุง ุจุฅุฒุงูุชูุง ูู ุฎูุงู ุฎุทูุฉ ุงูุชุตููุฉ ูุฐู:

```python
common_voice["train"]
```
**Output**
```
Dataset({
    features: ['input_features', 'labels', 'input_length'],
    num_rows: 4904
})
```

ุญุณููุง! ูู ูุฐู ุงูุญุงูุฉ ูุฏููุง ููุณ ุนุฏุฏ ุงูุนููุงุช ููุง ูุงู ูู ูุจูุ ูุฐูู ูู ุชูู ููุงู ุนููุงุช ุฃุทูู ูู 30 ุซุงููุฉ.
ูุฏ ูุง ูููู ูุฐุง ูู ุงูุญุงู ุฅุฐุง ููุช ุจุงูุชุจุฏูู ุจูู ุงููุบุงุชุ ูุฐูู ูู ุงูุฃูุถู ุงูุญูุงุธ ุนูู ุฎุทูุฉ ุงูุชุตููุฉ ูุฐู ูู ููุงููุง ูู ุฃุฌู ุงููุชุงูุฉ. ูุน
ุฐููุ ูุฏููุง ุจูุงูุงุชูุง ุฌุงูุฒุฉ ุชูุงููุง ููุชุฏุฑูุจ! ุฏุนูุง ูุณุชูุฑ ููููู ูุธุฑุฉ ุนูู ููููุฉ ุงุณุชุฎุฏุงู ูุฐู ุงูุจูุงูุงุช ูุชุฏุฑูุจ Whisper.

## ุงูุชุฏุฑูุจ ูุงูุชูููู

ุงูุขู ุจุนุฏ ุฃู ูููุง ุจุฅุนุฏุงุฏ ุจูุงูุงุชูุงุ ูุญู ูุณุชุนุฏูู ููุบูุต ูู ุฎุท ุฃูุงุจูุจ ุงูุชุฏุฑูุจ.
ุณูููู [๐ค Trainer](https://huggingface.co/transformers/master/main_classes/trainer.html?highlight=trainer)
ุจุฃุฏุงุก ุงููุซูุฑ ูู ุงูููุงู ุงูุดุงูุฉ ููุงุจุฉ ุนูุง. ูู ูุง ุนูููุง ูุนูู ูู:

- ุชุญุฏูุฏ ุฌุงูุน ุงูุจูุงูุงุช: ุฌุงูุน ุงูุจูุงูุงุช ูุฃุฎุฐ ุจูุงูุงุชูุง ุงูููุนุงูุฌุฉ ูุณุจููุง ูููุนุฏ ุชูุณูุฑุงุช PyTorch ุฌุงูุฒุฉ ูููููุฐุฌ.

- ููุงููุณ ุงูุชูููู: ุฃุซูุงุก ุงูุชููููุ ูุฑูุฏ ุชูููู ุงููููุฐุฌ ุจุงุณุชุฎุฏุงู ูููุงุณ ูุนุฏู ุงูุฎุทุฃ ูู ุงููููุฉ (WER). ูุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุฏุงูุฉ `compute_metrics` ุงูุชู ุชุชุนุงูู ูุน ูุฐุง ุงูุญุณุงุจ.

- ุชุญููู ููุทุฉ ุชูุชูุด ููุฏุฑุจุฉ ูุณุจููุง: ูุญุชุงุฌ ุฅูู ุชุญููู ููุทุฉ ุชูุชูุด ููุฏุฑุจุฉ ูุณุจููุง ูุชูููููุง ุจุดูู ุตุญูุญ ููุชุฏุฑูุจ.

- ุชุญุฏูุฏ ุญุฌุฌ ุงูุชุฏุฑูุจ: ุณูุชู ุงุณุชุฎุฏุงู ูุฐู ุงูุญุฌุฌ ูู ูุจู ๐ค Trainer ูู ุจูุงุก ุฌุฏูู ุงูุชุฏุฑูุจ.

ุจูุฌุฑุฏ ุฃู ูููู ุจุชุฏุฑูุจ ุงููููุฐุฌุ ุณูููู ุจุชููููู ุนูู ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ ููุชุญูู ูู ุฃููุง ูููุง ุจุชุฏุฑูุจู
ุจุดูู ุตุญูุญ ููุณุฎ ุงูููุงู ูู ุงููุบุฉ ุงูุฏูููููุฉ.

### ุชุญุฏูุฏ ุฌุงูุน ุงูุจูุงูุงุช

ุฌุงูุน ุงูุจูุงูุงุช ููููุฐุฌ ุงูููุงู ูู ุชุณูุณู ุฅูู ุชุณูุณู ูุฑูุฏ ูู ููุนู ุจูุนูู ุฃูู ูุชุนุงูู ูุน `input_features`
ู `labels` ุจุดูู ูุณุชูู: ูุฌุจ ุงูุชุนุงูู ูุน `input_features` ุจูุงุณุทุฉ ูุณุชุฎูุต ุงูููุฒุฉ ู `labels` ุจูุงุณุทุฉ ุงูุฑูุฒ ุงููููุฒ.

ุชู ุจุงููุนู ุฅุถุงูุฉ `input_features` ุฅูู 30 ุซุงููุฉ ูุชุญููููุง ุฅูู ูุฎุทุท ููู ููุบุงุฑูุชูู ุฐู ุจุนุฏ ุซุงุจุชุ ูุฐูู ูู ูุง
ุนูููุง ูุนูู ูู ุชุญููููุง ุฅูู ุชูุณูุฑุงุช PyTorch ูุฌููุนุฉ. ููุนู ุฐูู ุจุงุณุชุฎุฏุงู ุทุฑููุฉ `.pad` ููุณุชุฎูุต ุงูููุฒุฉ ูุน
`return_tensors=pt`. ูุงุญุธ ุฃูู ูุง ูุชู ุชุทุจูู ุฃู ูุณุงุฆุฏ ุฅุถุงููุฉ ููุง ูุธุฑูุง ูุฃู ุงููุฏุฎูุงุช ุฐุงุช ุจุนุฏ ุซุงุจุชุ ูุชู
ุชุญููู `input_features` ุจุจุณุงุทุฉ ุฅูู ุชูุณูุฑุงุช PyTorch.

ูู ูุงุญูุฉ ุฃุฎุฑูุ ูุฅู `labels` ุบูุฑ ููุถุงู ุฅูููุง ูุณุงุฆุฏ. ูููู ุฃููุงู ุจุฅุถุงูุฉ ูุณุงุฆุฏ ููุชุณูุณูุงุช ุฅูู ุงูุทูู ุงูุฃูุตู ูู ุงูุฏูุนุฉ ุจุงุณุชุฎุฏุงู
ุทุฑููุฉ `.pad` ููุฑูุฒ ุงููููุฒ. ุจุนุฏ ุฐูู ูุชู ุงุณุชุจุฏุงู ุฑููุฒ ุงููุณุงุฆุฏ ุจู `-100` ุจุญูุซ ูุง ูุชู ุฃุฎุฐ ูุฐู ุงูุฑููุฒ ูู ุงูุงุนุชุจุงุฑ ุนูุฏ ุญุณุงุจ ุงูุฎุณุงุฑุฉ. ุซู ูููู ุจูุทุน ุฑูุฒ ุจุฏุงูุฉ ุงููุต ูู ุจุฏุงูุฉ ุชุณูุณู ุงูุนูุงูุงุช
ุญูุซ ูููู ุจุฅูุญุงูู ูุงุญููุง ุฃุซูุงุก ุงูุชุฏุฑูุจ.

ูููููุง ุงูุงุณุชูุงุฏุฉ ูู `WhisperProcessor` ุงูุฐู ูููุง ุจุชุญุฏูุฏู ุณุงุจููุง ูุฃุฏุงุก ุนูููุงุช ูุณุชุฎูุต ุงูููุฒุฉ ูุงูุฑูุฒ ุงููููุฒ:

```python
import torch

from dataclasses import dataclass
from typing import Any, Dict, List, Union


@dataclass
class DataCollatorSpeechSeq2SeqWithPadding:
    processor: Any

    def __call__(
        self, features: List[Dict[str, Union[List[int], torch.Tensor]]]
    ) -> Dict[str, torch.Tensor]:
        # ุชูุณูู ุงููุฏุฎูุงุช ูุงูุนูุงูุงุช ุญูุซ ูุฌุจ ุฃู ุชููู ุจุทูู ูุฎุชูู ูุชุญุชุงุฌ ุฅูู ุทุฑู ูุณุงุฆุฏ ูุฎุชููุฉ
        # ุฃููุงู ูุชุนุงูู ูุน ุงููุฏุฎูุงุช ุงูุตูุชูุฉ ูู ุฎูุงู ุฅุนุงุฏุฉ ุชูุณูุฑุงุช PyTorch ุจุจุณุงุทุฉ
        input_features = [
            {"input_features": feature["input_features"][0]} for feature in features
        ]
        batch = self.processor.feature_extractor.pad(input_features, return_tensors="pt")

        # ุงูุญุตูู ุนูู ุชุณูุณูุงุช ุงูุนูุงูุงุช ุงููุฑูุฒุฉ
        label_features = [{"input_ids": feature["labels"]} for feature in features]
        # ุฅุถุงูุฉ ูุณุงุฆุฏ ููุนูุงูุงุช ุฅูู ุงูุทูู ุงูุฃูุตู
        labels_batch = self.processor.tokenizer.pad(label_features, return_tensors="pt")

        # ุงุณุชุจุฏุงู ุงููุณุงุฆุฏ ุจู -100 ูุชุฌุงูู ุงูุฎุณุงุฑุฉ ุจุดูู ุตุญูุญ
        labels = labels_batch["input_ids"].masked_fill(
            labels_batch.attention_mask.ne(1), -100
        )

        # ุฅุฐุง ูุงู ุฑูุฒ ุจุฏุงูุฉ ุงููุต ูููุญููุง ูู ุฎุทูุฉ ุงูุชุฌุฒุฆุฉ ุงูุณุงุจูุฉุ
        # ูุทุน ุฑูุฒ ุจุฏุงูุฉ ุงููุต ููุง ุญูุซ ูุชู ุฅูุญุงูู ูุงุญููุง ุนูู ุฃู ุญุงู
        if (labels[:, 0] == self.processor.tokenizer.bos_token_id).all().cpu().item():
            labels = labels[:, 1:]

        batch["labels"] = labels

        return batch
```

ุงูุขู ูููููุง ุชููุฆุฉ ุฌุงูุน ุงูุจูุงูุงุช ุงูุฐู ูููุง ุจุชุญุฏูุฏู ููุชู:

```python
data_collator = DataCollatorSpeechSeq2SeqWithPadding(processor=processor)
```

ุฅูู ุงูุฃูุงู!

### ููุงููุณ ุงูุชูููู

ุจุนุฏ ุฐููุ ูููู ุจุชุญุฏูุฏ ูููุงุณ ุงูุชูููู ุงูุฐู ุณูุณุชุฎุฏูู ุนูู ูุฌููุนุฉ ุงูุชูููู ุงูุฎุงุตุฉ ุจูุง. ุณูุณุชุฎุฏู ูููุงุณ ูุนุฏู ุงูุฎุทุฃ ูู ุงููููุฉ (WER) ุงูุฐู ุชู ุชูุฏููู
ูู ูุณู [ุงูุชูููู](evaluation)ุ ููู ุงููููุงุณ "ุจุญูู ุงูุฃูุฑ ุงููุงูุน" ูุชูููู ุฃูุธูุฉ ุงูุชุนุฑู ุนูู ุงูููุงู.

ุณูููู ุจุชุญููู ูููุงุณ WER ูู ๐ค Evaluate:

```python
import evaluate

metric = evaluate.load("wer")
```
ุงูุขูุ ุนูููุง ุจุจุณุงุทุฉ ุฃู ููุนุฑูู ุฏุงูุฉ ุชุฃุฎุฐ ุชูุจุคุงุช ุงููููุฐุฌ ูุชุนูุฏ ูููุงุณ WER. ูุฐู ุงูุฏุงูุฉุ ุงููุณูุงุฉ
`compute_metrics`ุ ุชุณุชุจุฏู ุฃููุงู ุงููููุฉ `-100` ุจู `pad_token_id` ูู `label_ids` (ุฅูุบุงุก ุงูุฎุทูุฉ ุงูุชู ุทุจููุงูุง ูู
ูุฌููุน ุงูุจูุงูุงุช ูุชุฌุงูู ุงูุฑููุฒ ุงูููุถุงู ุฅูููุง ุญุดู ุจุดูู ุตุญูุญ ูู ุงูุฎุณุงุฑุฉ). ุซู ุชููู ุจุชุฑููุฒ ุชูุจุคุงุช ูุฑูุฒ ุงูุชุณููุฉ ุฅูู ุณูุงุณู. ูุฃุฎูุฑูุงุ
ุชุญุณุจ WER ุจูู ุงูุชูุจุคุงุช ูุงูููุตูุงุช ุงููุฑุฌุนูุฉ. ููุงุ ูุฏููุง ุฎูุงุฑ ุงูุชูููู ุจุงุณุชุฎุฏุงู 'normalized'
ุงููุณุฎ ูุงูุชูุจุคุงุชุ ูุงูุชู ุชูุช ุฅุฒุงูุฉ ุนูุงูุงุช ุงูุชุฑููู ูุงูุญุงูุฉ ูููุง. ููุตู ุจุงุชุจุงุน ูุฐุง ุงูุฃูุฑ ููุงุณุชูุงุฏุฉ
ูู ุชุญุณูู WER ุงูุฐู ุชู ุงูุญุตูู ุนููู ุนู ุทุฑูู ุชุทุจูุน ุงููุณุฎ.

```python
from transformers.models.whisper.english_normalizer import BasicTextNormalizer

normalizer = BasicTextNormalizer()


def compute_metrics(pred):
    pred_ids = pred.predictions
    label_ids = pred.label_ids

    # ุงุณุชุจุฏู -100 ุจู pad_token_id
    label_ids[label_ids == -100] = processor.tokenizer.pad_token_id

    # ูุง ูุฑูุฏ ุชุฌููุน ุงูุฑููุฒ ุนูุฏ ุญุณุงุจ ุงูููุงููุณ
    pred_str = processor.batch_decode(pred_ids, skip_special_tokens=True)
    label_str = processor.batch_decode(label_ids, skip_special_tokens=True)

    # ุงุญุณุจ WER ุงูุฅููุงุฆู
    wer_ortho = 100 * metric.compute(predictions=pred_str, references=label_str)

    # ุงุญุณุจ WER ุงููุนูุงุฑู
    pred_str_norm = [normalizer(pred) for pred in pred_str]
    label_str_norm = [normalizer(label) for label in label_str]
    # ุฎุทูุฉ ุงูุชุฑุดูุญ ูุชูููู ุงูุนููุงุช ุงูุชู ุชูุงุจู ุงููุฑุงุฌุน ุบูุฑ ุงูุตูุฑูุฉ ููุท:
    pred_str_norm = [
        pred_str_norm[i] for i in range(len(pred_str_norm)) if len(label_str_norm[i]) > 0
    ]
    label_str_norm = [
        label_str_norm[i]
        for i in range(len(label_str_norm))
        if len(label_str_norm[i]) > 0
    ]

    wer = 100 * metric.compute(predictions=pred_str_norm, references=label_str_norm)

    return {"wer_ortho": wer_ortho, "wer": wer}
```

### ุชุญููู ููุทุฉ ุชูุชูุด ููุฏุฑุจุฉ ูุณุจููุง

ุงูุขูุ ุฏุนูุง ูุญูู ููุทุฉ ุชูุชูุด Whisper ุงูุตุบูุฑุฉ ุงูููุฏุฑุจุฉ ูุณุจููุง. ูุฑุฉ ุฃุฎุฑูุ ูุฐุง ุฃูุฑ ุณูู ูู ุฎูุงู ุงุณุชุฎุฏุงู ๐ค Transformers!

```python
from transformers import WhisperForConditionalGeneration

model = WhisperForConditionalGeneration.from_pretrained("openai/whisper-small")
```

ุณูููู ุจุชุนููู `use_cache` ุฅูู `False` ููุชุฏุฑูุจ ูุฃููุง ูุณุชุฎุฏู [gradient checkpointing](https://huggingface.co/docs/transformers/v4.18.0/en/performance#gradient-checkpointing)
ูููุงููุง ุบูุฑ ูุชูุงูู. ุณูููู ุฃูุถูุง ุจุชุฌุงูุฒ ุญุฌุชูู ูู ุญุฌุฌ ุงูุชูููุฏ ููุชุญูู ูู ุณููู ุงููููุฐุฌ ุฃุซูุงุก ุงูุงุณุชุฏูุงู:
ุณููุฑุถ ุฑููุฒ ุงููุบุฉ ูุงูููุงู ุฃุซูุงุก ุงูุชูููุฏ ุนู ุทุฑูู ุชุนููู ุญุฌุฌ `language` ู `task`ุ ูุฅุนุงุฏุฉ ุชูููู
ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ ููุชูููุฏ ูุชุณุฑูุน ููุช ุงูุงุณุชุฏูุงู:

```python
from functools import partial

# ุชุนุทูู ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ ุฃุซูุงุก ุงูุชุฏุฑูุจ ูุฃููุง ุบูุฑ ูุชูุงููุฉ ูุน gradient checkpointing
model.config.use_cache = False

# ุชุนููู ุงููุบุฉ ูุงูููุงู ููุชูููุฏ ูุฅุนุงุฏุฉ ุชูููู ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ
model.generate = partial(
    model.generate, language="sinhalese", task="transcribe", use_cache=True
)
```

## ุชุญุฏูุฏ ุชูููู ุงูุชุฏุฑูุจ

ูู ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉุ ูุญุฏุฏ ุฌููุน ุงููุนููุงุช ุงููุชุนููุฉ ุจุงูุชุฏุฑูุจ. ููุงุ ูุญุฏุฏ ุนุฏุฏ ุฎุทูุงุช ุงูุชุฏุฑูุจ ุฅูู 500.
ูุฐู ุงูุฎุทูุงุช ูุงููุฉ ูุฑุคูุฉ ุชุญุณู ูุจูุฑ ูู WER ููุงุฑูุฉ ุจูููุฐุฌ Whisper ุงูููุฏุฑุจ ูุณุจููุงุ ูุน ุถูุงู ุฃู ุนูููุฉ ุงูุถุจุท ุงูุฏููู ูููู
ุชุดุบูููุง ูู ุญูุงูู 45 ุฏูููุฉ ุนูู Google Colab ูุฌุงููุง. ููุฒูุฏ ูู ุงูุชูุงุตูู ุญูู ุญุฌุฌ ุงูุชุฏุฑูุจุ ุฑุงุฌุน
[ูุซุงุฆู](https://huggingface.co/docs/transformers/main_classes/trainer#transformers.Seq2SeqTrainingArguments) Seq2SeqTrainingArguments.

```python
from transformers import Seq2SeqTrainingArguments

training_args = Seq2SeqTrainingArguments(
    output_dir="./whisper-small-dv",  # ุงูุงุณู ุนูู HF Hub
    per_device_train_batch_size=16,
    gradient_accumulation_steps=1,  # ุฒูุงุฏุฉ ุจููุฏุงุฑ 2x ููู 2x ุงูุฎูุงุถ ูู ุญุฌู ุงูุฏููุนุฉ
    learning_rate=1e-5,
    lr_scheduler_type="constant_with_warmup",
    warmup_steps=50,
    max_steps=500,  # ุฒูุงุฏุฉ ุฅูู 4000 ุฅุฐุง ูุงู ูุฏูู ุจุทุงูุฉ ุฑุณูููุงุช ุฎุงุตุฉ ุจู ุฃู ุฎุทุฉ ูุฏููุนุฉ ูู Colab
    gradient_checkpointing=True,
    fp16=True,
    fp16_full_eval=True,
    evaluation_strategy="steps",
    per_device_eval_batch_size=16,
    predict_with_generate=True,
    generation_max_length=225,
    save_steps=500,
    eval_steps=500,
    logging_steps=25,
    report_to=["tensorboard"],
    load_best_model_at_end=True,
    metric_for_best_model="wer",
    greater_is_better=False,
    push_to_hub=True,
)
```

<Tip>
    ุฅุฐุง ููุช ูุง ุชุฑูุฏ ุชุญููู ููุงุท ุชูุชูุด ุงููููุฐุฌ ุฅูู Hubุ ูู ุจุชุนููู `push_to_hub=False`.
</Tip>

ูููููุง ุชูุฑูุฑ ุญุฌุฌ ุงูุชุฏุฑูุจ ุฅูู ๐ค Trainer ุฌูุจูุง ุฅูู ุฌูุจ ูุน ุงููููุฐุฌุ ููุฌููุนุฉ ุงูุจูุงูุงุชุ ููุฌููุน ุงูุจูุงูุงุชุ ูุฏุงูุฉ `compute_metrics`:

```python
from transformers import Seq2SeqTrainer

trainer = Seq2SeqTrainer(
    args=training_args,
    model=model,
    train_dataset=common_voice["train"],
    eval_dataset=common_voice["test"],
    data_collator=data_collator,
    compute_metrics=compute_metrics,
    tokenizer=processor,
)
```

ูุจุฐููุ ูููู ูุณุชุนุฏูู ูุจุฏุก ุงูุชุฏุฑูุจ!

### ุงูุชุฏุฑูุจ

ูุจุฏุก ุงูุชุฏุฑูุจุ ูู ุจุจุณุงุทุฉ ุจุชูููุฐ:

```python
trainer.train()
```

ุณูุณุชุบุฑู ุงูุชุฏุฑูุจ ุญูุงูู 45 ุฏูููุฉ ุงุนุชูุงุฏูุง ุนูู ุจุทุงูุฉ ุงูุฑุณูููุงุช ุงูุฎุงุตุฉ ุจู ุฃู ุชูู ุงููุฎุตุตุฉ ูู Google Colab. ุงุนุชูุงุฏูุง ุนูู
ุจุทุงูุฉ ุงูุฑุณูููุงุช ุงูุฎุงุตุฉ ุจูุ ูู ุงููููู ุฃู ุชูุงุฌู ุฎุทุฃ CUDA `"out-of-memory"` ุนูุฏ ุจุฏุก ุงูุชุฏุฑูุจ. ูู ูุฐู ุงูุญุงูุฉุ
ููููู ุชูููู `per_device_train_batch_size` ุชุฏุฑูุฌููุง ุจุนูุงูู 2 ูุงุณุชุฎุฏุงู [`gradient_accumulation_steps`](https://huggingface.co/docs/transformers/main_classes/trainer#transformers.Seq2SeqTrainingArguments.gradient_accumulation_steps)
ููุชุนููุถ.

**ุงูุฅุฎุฑุงุฌ:**

| ุฎุณุงุฑุฉ ุงูุชุฏุฑูุจ | ุงูุญูุจุฉ | ุงูุฎุทูุฉ | ุฎุณุงุฑุฉ ุงูุชุญูู | Wer Ortho | Wer     |
|:-------------:|:-----:|:----:|:---------------:|:---------:|:-------:|
| 0.136         | 1.63  | 500  | 0.1727          | 63.8972   | 14.0661 |

WER ุงูููุงุฆู ูุฏููุง ูู 14.1% - ููุณ ุณูุฆูุง ูุณุจุน ุณุงุนุงุช ูู ุจูุงูุงุช ุงูุชุฏุฑูุจ ู500 ุฎุทูุฉ ุชุฏุฑูุจ ููุท! ููุฐุง ููุนุงุฏู ุชุญุณููุง ุจูุณุจุฉ 112%
ููุงุฑูุฉ ุจุงููููุฐุฌ ุงูููุฏุฑุจ ูุณุจููุง! ููุฐุง ูุนูู ุฃููุง ูููุง ุจุถุจุท ูููุฐุฌ ูู ููู ูุฏูู ุณุงุจููุง ุฃู ูุนุฑูุฉ ุนู ุงููุบุฉ ุงูุฏูููููุฉุ
ูุถุจุทูุงู ุจุฏูุฉ ููุชุนุฑู ุนูู ุงูููุงู ุงูุฏููููู ุจุฏูุฉ ูุงููุฉ ูู ุฃูู ูู ุณุงุนุฉ ๐คฏ

ุงูุณุคุงู ุงููุจูุฑ ูู ููู ููุงุฑู ูุฐุง ุจุฃูุธูุฉ ASR ุงูุฃุฎุฑู. ููุฐุงุ ูููููุง ุนุฑุถ [ููุญุฉ ุงูููุงุฏุฉ](https://huggingface.co/spaces/autoevaluate/leaderboards?dataset=mozilla-foundation%2Fcommon_voice_13_0&only_verified=0&task=automatic-speech-recognition&config=dv&split=test&metric=wer) autoevaluateุ
ููุญุฉ ููุงุฏุฉ ุชุตูู ุงูููุงุฐุฌ ุญุณุจ ุงููุบุฉ ููุฌููุนุฉ ุงูุจูุงูุงุชุ ุซู ุชุฑุชุจูุง ููููุง ูู WER.

ุนูุฏ ุงููุธุฑ ุฅูู ููุญุฉ ุงูููุงุฏุฉุ ูุฑู ุฃู ูููุฐุฌูุง ุงููุฏุฑุจ ุนูู 500 ุฎุทูุฉ ูุชููู ุจุดูู ูููุน ุนูู ููุทุฉ ุชูุชูุด [Whisper Small](https://huggingface.co/openai/whisper-small)
ุงูููุฏุฑุจุฉ ูุณุจููุง ูุงูุชู ูููุง ุจุชูููููุง ูู ุงููุณู ุงูุณุงุจู. ุนูู ุฌูุฏ ๐

ูุฑู ุฃู ููุงู ุจุนุถ ููุงุท ุงูุชูุชูุด ุงูุชู ุชุคุฏู ุจุดูู ุฃูุถู ูู ุชูู ุงูุชู ูููุง ุจุชุฏุฑูุจูุง. ุฌูุงู ููุตุฉ Hugging Face Hub ูู ุฃููุง
ููุตุฉ ุชุนุงูููุฉ - ุฅุฐุง ูู ููู ูุฏููุง ุงูููุช ุฃู ุงูููุงุฑุฏ ููููุงู ุจุชุดุบูู ุชุฏุฑูุจ ุฃุทูู ุจุฃููุณูุงุ ูููููุง
ุชุญููู ููุทุฉ ุชูุชูุด ูุงู ุดุฎุต ุขุฎุฑ ูู ุงููุฌุชูุน ุจุชุฏุฑูุจูุง ููุงู ูุทูููุง ุจูุง ูููู ููุดุงุฑูุชูุง (ูุน ุงูุชุฃูุฏ ูู ุดูุฑู ุนูู ุฐูู!).
ุณุชุชููู ูู ุชุญููู ูุฐู ููุงุท ุงูุชูุชูุด ุจููุณ ุงูุทุฑููุฉ ุชูุงููุง ููุง ูู ุงูุญุงู ูุน ููุงุท ุงูุชูุชูุด ุงูููุฏุฑุจุฉ ูุณุจููุง ุจุงุณุชุฎุฏุงู ูุฆุฉ `pipeline` ููุง
ูุนููุง ุณุงุจููุง! ูุฐูู ูุง ุดูุก ูููุนู ูู ุงุฎุชูุงุฑ ุฃูุถู ูููุฐุฌ ุนูู ููุญุฉ ุงูููุงุฏุฉ ูุงุณุชุฎุฏุงูู ูู ูููุชู!

ูููููุง ุฅุฑุณุงู ููุทุฉ ุงูุชูุชูุด ุงูุฎุงุตุฉ ุจูุง ุชููุงุฆููุง ุฅูู ููุญุฉ ุงูููุงุฏุฉ ุนูุฏูุง ูุฑุณู ูุชุงุฆุฌ ุงูุชุฏุฑูุจ ุฅูู Hub - ุจุจุณุงุทุฉ
ูุฌุจ ุนูููุง ุชุนููู ุญูุฌุฌ ุงููููุงุช ุงูุฑุฆูุณูุฉ ุงูููุงุณุจุฉ (kwargs). ููููู ุชุบููุฑ ูุฐู ุงูููู ููุทุงุจูุฉ ูุฌููุนุฉ ุงูุจูุงูุงุช ูุงููุบุฉ ู
ุงุณู ุงููููุฐุฌ ููููุง ูุฐูู:

```python
kwargs = {
    "dataset_tags": "mozilla-foundation/common_voice_13_0",
    "dataset": "Common Voice 13",  # ุงุณู 'ุฌููู' ููุฌููุนุฉ ุจูุงูุงุช ุงูุชุฏุฑูุจ
    "language": "dv",
    "model_name": "Whisper Small Dv - Sanchit Gandhi",  # ุงุณู 'ุฌููู' ููููุฐุฌู
    "finetuned_from": "openai/whisper-small",
    "tasks": "automatic-speech-recognition",
}
```
ูููู ุงูุขู ุชุญููู ูุชุงุฆุฌ ุงูุชุฏุฑูุจ ุฅูู ุงููุฑูุฒ. ููููุงู ุจุฐููุ ููุฐ ุงูุฃูุฑ `push_to_hub`:

```python
trainer.push_to_hub(**kwargs)
```

ุณูููู ูุฐุง ุงูุฃูุฑ ุจุญูุธ ุณุฌูุงุช ุงูุชุฏุฑูุจ ูุฃูุฒุงู ุงููููุฐุฌ ุชุญุช `"ุงุณู-ุงููุณุชุฎุฏู-ุงูุฎุงุต-ุจู/ุงูุงุณู-ุงูุฐู-ุงุฎุชุฑุชู"`. ููุงุทูุงุน ุนูู ูุฐุง ุงููุซุงูุ ุชุญูู ูู ุงูุฑูุน ุนูู ุงูุฑุงุจุท `sanchit-gandhi/whisper-small-dv`.

ุนูู ุงูุฑุบู ูู ุฃู ุงููููุฐุฌ ุงููุนุฏู ููุธูุฑ ูุชุงุฆุฌ ูุฑุถูุฉ ุนูู ุจูุงูุงุช ุงุฎุชุจุงุฑ Common Voice 13 Dhivehiุ ุฅูุง ุฃูู ููุณ ุงูุฃูุซู ุจุฃู ุญุงู ูู ุงูุฃุญูุงู.
ุงูุบุฑุถ ูู ูุฐุง ุงูุฏููู ูู ุชูุถูุญ ููููุฉ ุชุนุฏูู ูููุฐุฌ ASR ุจุงุณุชุฎุฏุงู ๐ค Trainer ููุชุนุฑู ุนูู ุงูููุงู ูุชุนุฏุฏ ุงููุบุงุช.

ุฅุฐุง ูุงู ูุฏูู ุฅููุงููุฉ ุงููุตูู ุฅูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPU) ุงูุฎุงุตุฉ ุจู ุฃู ููุช ูุดุชุฑููุง ูู ุฎุทุฉ ูุฏููุนุฉ ูู Google Colabุ ููููู ุฒูุงุฏุฉ `max_steps` ุฅูู 4000 ุฎุทูุฉ
ูุชุญุณูู WER ุจุดูู ุฃูุจุฑ ูู ุฎูุงู ุงูุชุฏุฑูุจ ุนูู ุงููุฒูุฏ ูู ุงูุฎุทูุงุช. ุณูุณุชุบุฑู ุงูุชุฏุฑูุจ ููุฏุฉ 4000 ุฎุทูุฉ ุญูุงูู 3-5 ุณุงุนุงุช ุงุนุชูุงุฏูุง
ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPU) ุงูุฎุงุตุฉ ุจู ูุณูุญูู ูุชุงุฆุฌ WER ุฃูู ุจุญูุงูู 3% ูู ุงูุชุฏุฑูุจ ููุฏุฉ 500 ุฎุทูุฉ. ุฅุฐุง ูุฑุฑุช ุงูุชุฏุฑูุจ ููุฏุฉ 4000 ุฎุทูุฉุ
ููุตู ุฃูุถูุง ุจุชุบููุฑ ุฌุฏูู ูุนุฏู ุงูุชุนูู ุฅูู ุฌุฏูู *ุฎุทู* (ูู ุจุชุนููู `lr_scheduler_type="linear"`)ุ ุญูุซ ุณูุคุฏู ุฐูู
ุฅูู ุชุนุฒูุฒ ุงูุฃุฏุงุก ุงูุฅุถุงูู ุนูู ูุฏุงุฑ ุนูููุงุช ุงูุชุฏุฑูุจ ุงูุทูููุฉ.

ูู ุงููุญุชูู ุฃู ุชุชุญุณู ุงููุชุงุฆุฌ ุฃูุซุฑ ูู ุฎูุงู ุชุญุณูู ูุฑุท ูุนููุงุช ุงูุชุฏุฑูุจุ ูุซู _ูุนุฏู ุงูุชุนูู_
ู_ุงูุชุฎูู_ุ ูุงุณุชุฎุฏุงู ููุทุฉ ุชูุชูุด ูุณุจูุฉ ุงูุชุฏุฑูุจ ุฃูุจุฑ (`ูุชูุณุทุฉ` ุฃู `ูุจูุฑุฉ`). ูุชุฑู ูุฐุง ูุชูุฑูู ูููุงุฑุฆ.

## ูุดุงุฑูุฉ ูููุฐุฌู

ููููู ุงูุขู ูุดุงุฑูุฉ ูุฐุง ุงููููุฐุฌ ูุน ุฃู ุดุฎุต ุจุงุณุชุฎุฏุงู ุงูุฑุงุจุท ุนูู ุงููุฑูุฒ. ูููููู ุชุญูููู ุจุงุณุชุฎุฏุงู ุงููุนุฑู `"ุงุณู-ุงููุณุชุฎุฏู-ุงูุฎุงุต-ุจู/ุงูุงุณู-ุงูุฐู-ุงุฎุชุฑุชู"`
ูุจุงุดุฑุฉู ูู ูุงุฆู `pipeline()`. ุนูู ุณุจูู ุงููุซุงูุ ูุชุญููู ููุทุฉ ุงูุชูุชูุด ุงููุนุฏูุฉ ["sanchit-gandhi/whisper-small-dv"](https://huggingface.co/sanchit-gandhi/whisper-small-dv):

```python
from transformers import pipeline

pipe = pipeline("automatic-speech-recognition", model="sanchit-gandhi/whisper-small-dv")
```

## ุงูุฎุงุชูุฉ

ูู ูุฐุง ุงููุณูุ ูููุง ุจุชุบุทูุฉ ุฏููู ุฎุทูุฉ ุจุฎุทูุฉ ุญูู ุชุนุฏูู ูููุฐุฌ Whisper ููุชุนุฑู ุนูู ุงูููุงู ๐ค Datasetsุ
ูTransformers ูHugging Face Hub. ูููุง ุฃููุงู ุจุชุญููู ุงููุฌููุนุฉ ุงููุฑุนูุฉ Dhivehi ูู ูุฌููุนุฉ ุจูุงูุงุช Common Voice 13 ููููุง ุจูุนุงูุฌุชูุง ูุณุจููุง
ูู ุฎูุงู ุญุณุงุจ ูุฎุทุทุงุช log-mel spectrograms ูุชูุทูุน ุงููุต. ุซู ูููุง ุจุชุนุฑูู ุฌุงูุน ุงูุจูุงูุงุชุ ููููุงุณ ุงูุชููููุ
ูุญุฌุฌ ุงูุชุฏุฑูุจุ ูุจู ุงุณุชุฎุฏุงู ๐ค Trainer ูุชุฏุฑูุจ ูุชูููู ูููุฐุฌูุง. ุฃููููุง ุจุชุญููู ุงููููุฐุฌ ุงููุนุฏู ุฅูู Hugging Face Hubุ
ูุนุฑุถูุง ููููุฉ ูุดุงุฑูุชู ูุงุณุชุฎุฏุงูู ูุน ูุฆุฉ `pipeline()`.

ุฅุฐุง ุชุงุจุนุช ุญุชู ูุฐู ุงูููุทุฉุ ูุฌุจ ุฃู ูููู ูุฏูู ุงูุขู ููุทุฉ ุชูุชูุด ูุนุฏูุฉ ููุชุนุฑู ุนูู ุงูููุงูุ ุนูู ุฌูุฏ! ๐ฅณ
ูุงูุฃูู ูู ุฐููุ ุฃูู ูุฌูุฒ ุจุฌููุน ุงูุฃุฏูุงุช ุงูุชู ุชุญุชุงุฌูุง ูุชุนุฏูู ูููุฐุฌ Whisper ุนูู ุฃู ูุฌููุนุฉ ุจูุงูุงุช ุฃู ูุฌุงู ููุชุนุฑู ุนูู ุงูููุงู. ูุฐุงุ ูุงุฐุง ุชูุชุธุฑ! ุงุฎุชุฑ ูุงุญุฏุฉ ูู ูุฌููุนุงุช ุงูุจูุงูุงุช ุงููุดูููุฉ ูู ุงููุณู [ุงุฎุชูุงุฑ ูุฌููุนุฉ ุจูุงูุงุช](choosing_dataset)
ุฃู ุญุฏุฏ ูุฌููุนุฉ ุจูุงูุงุช ุฎุงุตุฉ ุจูุ ูุดุงูุฏ ูุง ุฅุฐุง ูุงู ุจุฅููุงูู ุงูุญุตูู ุนูู ุฃุฏุงุก ูุชูุฏู! ููุญุฉ ุงูููุงุฏุฉ ูู ุงูุชุธุงุฑู...