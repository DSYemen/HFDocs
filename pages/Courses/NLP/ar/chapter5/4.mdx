# ุงูุจูุงูุงุช ุงูุถุฎูุฉุ ๐ค ูุฌููุนุงุช ุงูุจูุงูุงุช ูุฅููุงุฐู! [[big-data-datasets-to-the-rescue]]

<CourseFloatingBanner chapter={5}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/en/chapter5/section4.ipynb"},
    {label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/en/chapter5/section4.ipynb"},
]} />


ูู ูุนุฏ ูู ุบูุฑ ุงููุฃููู ูู ุฃูุงููุง ูุฐู ุฃู ุชุฌุฏ ููุณู ุชุนูู ูุน ูุฌููุนุงุช ุจูุงูุงุช ูุชุนุฏุฏุฉ ุงูุบูุบุงุจุงูุชุ ุฎุงุตุฉ ุฅุฐุง ููุช ุชุฎุทุท ูุชุฏุฑูุจ ูุญูู ูู ุงูุตูุฑ ูุซู BERT ุฃู GPT-2. ูู ูุฐู ุงูุญุงูุงุชุ ุญุชู _ุชุญููู_ ุงูุจูุงูุงุช ูููู ุฃู ูููู ุชุญุฏูุง. ุนูู ุณุจูู ุงููุซุงูุ ูุชููู ูููู WebText ุงููุณุชุฎุฏู ูุชุฏุฑูุจ GPT-2 ูู ุฃูุซุฑ ูู 8 ููุงููู ูุซููุฉ ู40 ุบูุบุงุจุงูุช ูู ุงููุต -- ุชุญููู ูุฐุง ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ูุฌูุงุฒ ุงูููุจููุชุฑ ุงููุญููู ุงูุฎุงุต ุจู ูู ุงููุฑุฌุญ ุฃู ูุตูุจู ุจููุจุฉ ููุจูุฉ!

ูุญุณู ุงูุญุธุ ุชู ุชุตููู ๐ค Datasets ููุชุบูุจ ุนูู ูุฐู ุงููููุฏ. ููู ูุญุฑุฑู ูู ูุดุงูู ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ ูู ุฎูุงู ูุนุงููุฉ ูุฌููุนุงุช ุงูุจูุงูุงุช ููููุงุช _ูุฎุทุทุฉ ููุฐุงูุฑุฉ_ุ ููู ุญุฏูุฏ ุงููุฑุต ุงูุตูุจ ูู ุฎูุงู _ุจุซ_ ุงูุฅุฏุฎุงูุงุช ูู ูุฌููุนุฉ ูู ุงููุตูุต.

<Youtube id="JwISwTCPPWo"/>

ูู ูุฐุง ุงููุณูุ ุณูุณุชูุดู ูุฐู ุงูููุฒุงุช ูู ๐ค Datasets ูุน ูุฌููุนุฉ ูุตูุต ุถุฎูุฉ ุชุจูุบ 825 ุบูุบุงุจุงูุช ุชุนุฑู ุจุงุณู [the Pile](https://pile.eleuther.ai). ููุจุฏุฃ!

## ูุง ูู the Pileุ [[what-is-the-pile]]

The Pile ุนุจุงุฑุฉ ุนู ูุฌููุนุฉ ูุตูุต ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ุชู ุฅูุดุงุคูุง ุจูุงุณุทุฉ [EleutherAI](https://www.eleuther.ai) ูุชุฏุฑูุจ ููุงุฐุฌ ุงููุบุฉ ูุงุณุนุฉ ุงููุทุงู. ูุชุถูู ูุฌููุนุฉ ูุชููุนุฉ ูู ูุฌููุนุงุช ุงูุจูุงูุงุชุ ุชุดูู ุงูููุงูุงุช ุงูุนูููุฉุ ููุณุชูุฏุนุงุช ุดูุฑุฉ GitHubุ ูุงููุตูุต ุงูููุจ ุงููููุชุฑุฉ. ูุฌููุนุฉ ุงูุชุฏุฑูุจ ูุชููุฑุฉ ูู [ูุทุน 14 ุบูุบุงุจุงูุช](https://the-eye.eu/public/AI/pile/)ุ ูููููู ุฃูุถูุง ุชูุฒูู ุงูุนุฏูุฏ ูู [ุงูููููุงุช ุงููุฑุฏูุฉ](https://the-eye.eu/public/AI/pile_preliminary_components/). ุฏุนูุง ูุจุฏุฃ ุจุฅููุงุก ูุธุฑุฉ ุนูู ูุฌููุนุฉ ุจูุงูุงุช PubMed Abstractsุ ููู ูุฌููุนุฉ ูุตูุต ูู ุงูููุฎุตุงุช ูู 15 ููููู ููุดูุฑ ุจููููุฌู ุทุจู ุนูู [PubMed](https://pubmed.ncbi.nlm.nih.gov/). ูุฌููุนุฉ ุงูุจูุงูุงุช ูู [ุชูุณูู ุฎุทูุท JSON](https://jsonlines.org) ููุชู ุถุบุทูุง ุจุงุณุชุฎุฏุงู ููุชุจุฉ `zstandard`ุ ูุฐุง ูุญุชุงุฌ ุฃููุงู ุฅูู ุชุซุจูุชูุง:

```py
!pip install zstandard
```

ุจุนุฏ ุฐููุ ูููููุง ุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุงูุทุฑููุฉ ูููููุงุช ุงูุจุนูุฏุฉ ุงูุชู ุชุนูููุงูุง ูู [ุงููุณู 2](/course/chapter5/2):

```py
from datasets import load_dataset

# ูุณุชุบุฑู ูุฐุง ุจุถุน ุฏูุงุฆู ููุชุดุบููุ ูุฐุง ุงุญุตู ุนูู ุดุงู ุฃู ูููุฉ ุฃุซูุงุก ุงูุงูุชุธุงุฑ :)
data_files = "https://the-eye.eu/public/AI/pile_preliminary_components/PUBMED_title_abstracts_2019_baseline.jsonl.zst"
pubmed_dataset = load_dataset("json", data_files=data_files, split="train")
pubmed_dataset
```

```python out
Dataset({
    features: ['meta', 'text'],
    num_rows: 15518009
})
```

ูููููุง ุฃู ูุฑู ุฃู ููุงู 15,518,009 ุตููู ูุนููุฏูู ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูุง -- ูุฐุง ูุซูุฑ!

<Tip>

โ ุจุดูู ุงูุชุฑุงุถูุ ุณูููู ๐ค Datasets ุจูู ุถุบุท ุงููููุงุช ุงููุงุฒูุฉ ูุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช. ุฅุฐุง ููุช ุชุฑูุฏ ุงูุญูุงุธ ุนูู ูุณุงุญุฉ ุงููุฑุต ุงูุตูุจุ ููููู ุชูุฑูุฑ `DownloadConfig(delete_extracted=True)` ุฅูู ุญุฌุฉ `download_config` ูู `load_dataset()`. ุฑุงุฌุน [ุงููุซุงุฆู](https://huggingface.co/docs/datasets/package_reference/builder_classes#datasets.DownloadConfig) ููุฒูุฏ ูู ุงูุชูุงุตูู.

</Tip>

ุฏุนูุง ูุชููุฏ ูุญุชููุงุช ุงููุซุงู ุงูุฃูู:

```py
pubmed_dataset[0]
```

```python out
{'meta': {'pmid': 11409574, 'language': 'eng'},
 'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}
```

ุญุณูุงุ ูุจุฏู ูุฐุง ูุซู ููุฎุต ูู ููุงูุฉ ุทุจูุฉ. ูุงูุขู ุฏุนูุง ูุฑู ูููุฉ ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุงูุชู ุงุณุชุฎุฏููุงูุง ูุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช!

## ุณุญุฑ ุชุฎุทูุท ุงูุฐุงูุฑุฉ [[the-magic-of-memory-mapping]]

ููุงู ุทุฑููุฉ ุจุณูุทุฉ ูููุงุณ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ ูู ุจุงูุซูู ููู ููุชุจุฉ [`psutil`](https://psutil.readthedocs.io/en/latest/)ุ ูุงูุชู ูููู ุชุซุจูุชูุง ุจุงุณุชุฎุฏุงู `pip` ููุง ููู:

```python
!pip install psutil
```

ุชููุฑ ูุฆุฉ `Process` ุงูุชู ุชุณูุญ ููุง ุจุงูุชุญูู ูู ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ ููุนูููุฉ ุงูุญุงููุฉ ููุง ููู:

```py
import psutil

# Process.memory_info ูุนุจุฑ ุนููุง ุจุงูุจุงูุชุ ูุฐุง ูู ุจุงูุชุญููู ุฅูู ููุบุงุจุงูุช
print(f"RAM used: {psutil.Process().memory_info().rss / (1024 * 1024):.2f} MB")
```

```python out
RAM used: 5678.33 MB
```

ููุง ูุดูุฑ ุงูุณูุฉ `rss` ุฅูู _ุญุฌู ุงููุฌููุนุฉ ุงูููููุฉ_ุ ููู ุฌุฒุก ุงูุฐุงูุฑุฉ ุงูุฐู ุชุดุบูู ุงูุนูููุฉ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู. ูุดูู ูุฐุง ุงูููุงุณ ุฃูุถูุง ุงูุฐุงูุฑุฉ ุงููุณุชุฎุฏูุฉ ุจูุงุณุทุฉ ููุณุฑ ุจุงูุซูู ูุงูููุชุจุงุช ุงูุชู ูููุง ุจุชุญููููุงุ ูุฐุง ูุฅู ุงููููุฉ ุงููุนููุฉ ูู ุงูุฐุงูุฑุฉ ุงููุณุชุฎุฏูุฉ ูุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช ุฃุตุบุฑ ููููุงู. ููููุงุฑูุฉุ ุฏุนูุง ูุฑู ุญุฌู ูุฌููุนุฉ ุงูุจูุงูุงุช ุนูู ุงููุฑุตุ ุจุงุณุชุฎุฏุงู ุงูุณูุฉ `dataset_size`. ูุธุฑูุง ูุฃู ุงููุชูุฌุฉ ูุนุจุฑ ุนููุง ุจุงูุจุงูุช ูุซู ุงูุณุงุจูุ ูุญุชุงุฌ ุฅูู ุชุญููููุง ูุฏูููุง ุฅูู ุบูุบุงุจุงูุช:

```py
print(f"Number of files in dataset : {pubmed_dataset.dataset_size}")
size_gb = pubmed_dataset.dataset_size / (1024**3)
print(f"Dataset size (cache file) : {size_gb:.2f} GB")
```

```python out
Number of files in dataset : 20979437051
Dataset size (cache file) : 19.54 GB
```

ุฑุงุฆุน -- ุนูู ุงูุฑุบู ูู ุฃููุง ูุจูุฑุฉ ุจุญุฌู 20 ุบูุบุงุจุงูุช ุชูุฑูุจูุงุ ุฅูุง ุฃููุง ูุงุฏุฑูู ุนูู ุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช ูุงููุตูู ุฅูููุง ุจุงุณุชุฎุฏุงู ุฐุงูุฑุฉ ูุตูู ุนุดูุงุฆู ุฃูู ุจูุซูุฑ!

<Tip>

โ๏ธ **ุฌุฑุจูุง!** ุงุฎุชุฑ ูุงุญุฏุฉ ูู [ุงููุฌููุนุงุช ุงููุฑุนูุฉ](https://the-eye.eu/public/AI/pile_preliminary_components/) ูู the Pile ุฃูุจุฑ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ูุฌูุงุฒ ุงูููุจููุชุฑ ุงููุญููู ุฃู ุณุทุญ ุงูููุชุจ ุงูุฎุงุต ุจูุ ููู ุจุชุญููููุง ุจุงุณุชุฎุฏุงู ๐ค Datasetsุ ูููุงุณ ูููุฉ ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุงููุณุชุฎุฏูุฉ. ูุงุญุธ ุฃูู ููุญุตูู ุนูู ููุงุณ ุฏูููุ ุณุชุฑุบุจ ูู ุงูููุงู ุจุฐูู ูู ุนูููุฉ ุฌุฏูุฏุฉ. ููููู ุงูุนุซูุฑ ุนูู ุงูุฃุญุฌุงู ุบูุฑ ุงููุถุบูุทุฉ ููู ูุฌููุนุฉ ูุฑุนูุฉ ูู ุงูุฌุฏูู 1 ูู [ูุฑูุฉ the Pile](https://arxiv.org/abs/2101.00027).

</Tip>

ุฅุฐุง ููุช ุนูู ุฏุฑุงูุฉ ุจู Pandasุ ููุฏ ุชุฃุชู ูุฐู ุงููุชูุฌุฉ ูููุงุฌุฃุฉ ุจุณุจุจ ูุงุนุฏุฉ Wes Kinney ุงูุดููุฑุฉ [rule of thumb](https://wesmckinney.com/blog/apache-arrow-pandas-internals/) ุงูุชู ุชุญุชุงุฌ ุนุงุฏุฉู ุฅูู 5 ุฅูู 10 ุฃุถุนุงู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ูุญุฌู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู. ุฅุฐู ููู ูุญู ๐ค Datasets ูุดููุฉ ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ ูุฐูุ ๐ค Datasets ุชุนุงูู ูู ูุฌููุนุฉ ุจูุงูุงุช ูููู [ูุฎุทุท ููุฐุงูุฑุฉ](https://en.wikipedia.org/wiki/Memory-mapped_file)ุ ูุงูุฐู ูููุฑ ุฎุฑูุทุฉ ุจูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ูุชุฎุฒูู ูุธุงู ุงููููุงุช ุงูุฐู ูุณูุญ ููููุชุจุฉ ุจุงููุตูู ุฅูู ุนูุงุตุฑ ูุฌููุนุฉ ุงูุจูุงูุงุช ูุงูุชุดุบูู ุนูููุง ุฏูู ุงูุญุงุฌุฉ ุฅูู ุชุญููููุง ุจุงููุงูู ูู ุงูุฐุงูุฑุฉ.

ูููู ุฃูุถูุง ูุดุงุฑูุฉ ุงููููุงุช ุงููุฎุทุทุฉ ููุฐุงูุฑุฉ ุนุจุฑ ุนูููุงุช ูุชุนุฏุฏุฉุ ููุง ููููู ุงูุทุฑู ูุซู `Dataset.map()` ูู ุฃู ุชููู ูุชูุงุฒูุฉ ุฏูู ุงูุญุงุฌุฉ ุฅูู ููู ุฃู ูุณุฎ ูุฌููุนุฉ ุงูุจูุงูุงุช. ุชุญุช ุงูุบุทุงุกุ ูุชู ุชุญููู ูุฐู ุงูุฅููุงููุงุช ุฌููุนูุง ุจูุงุณุทุฉ ุชูุณูู ุงูุฐุงูุฑุฉ [Apache Arrow](https://arrow.apache.org) ูููุชุจุฉ [`pyarrow`](https://arrow.apache.org/docs/python/index.html)ุ ููุง ูุฌุนู ุชุญููู ุงูุจูุงูุงุช ููุนุงูุฌุชูุง ุณุฑูุนูุง ููุบุงูุฉ. (ููุฒูุฏ ูู ุงูุชูุงุตูู ุญูู Apache Arrow ูุงูููุงุฑูุงุช ูุน Pandasุ ุชุญูู ูู [ููุดูุฑ ูุฏููุฉ Dejan Simic](https://towardsdatascience.com/apache-arrow-read-dataframe-with-zero-memory-69634092b1a).) ูุฑุคูุฉ ุฐูู ูู ุงูุนููุ ุฏุนูุง ูุฌุฑู ุงุฎุชุจุงุฑ ุณุฑุนุฉ ุตุบูุฑ ูู ุฎูุงู ุงูุชูุฑุงุฑ ุนูู ุฌููุน ุงูุนูุงุตุฑ ูู ูุฌููุนุฉ ุจูุงูุงุช PubMed Abstracts:

```py
import timeit

code_snippet = """batch_size = 1000

for idx in range(0, len(pubmed_dataset), batch_size):
    _ = pubmed_dataset[idx:idx + batch_size]
"""

time = timeit.timeit(stmt=code_snippet, number=1, globals=globals())
print(
    f"Iterated over {len(pubmed_dataset)} examples (about {size_gb:.1f} GB) in "
    f"{time:.1f}s, i.e. {size_gb/time:.3f} GB/s"
)
```

```python out
'Iterated over 15518009 examples (about 19.5 GB) in 64.2s, i.e. 0.304 GB/s'
```
'ุชูุช ูุนุงูุฌุฉ 15518009 ูุซุงู (ุญูุงูู 19.5 ุฌูุฌุงุจุงูุช) ูู 64.2 ุซุงููุฉุ ุฃู 0.304 ุฌูุฌุงุจุงูุช/ุซุงููุฉ'
```

ููุงุ ุงุณุชุฎุฏููุง ูุญุฏุฉ `timeit` ูู ุจุงูุซูู ูููุงุณ ููุช ุงูุชูููุฐ ุงูุฐู ุงุณุชุบุฑูู `code_snippet`. ุนุงุฏุฉุ ุณุชุชููู ูู ูุนุงูุฌุฉ ูุฌููุนุฉ ุจูุงูุงุช ุจุณุฑุนุฉ ุจุถุนุฉ ุฃุนุดุงุฑ ูู ุฌูุฌุงุจุงูุช/ุซุงููุฉ ุฅูู ุนุฏุฉ ุฌูุฌุงุจุงูุช/ุซุงููุฉ. ูุฐุง ูุนูู ุจุดูู ุฑุงุฆุน ููุนุธู ุงูุชุทุจููุงุชุ ูููู ูู ุจุนุถ ุงูุฃุญูุงู ุณูุชุนูู ุนููู ุงูุนูู ูุน ูุฌููุนุฉ ุจูุงูุงุช ูุจูุฑุฉ ุฌุฏูุง ูุฏุฑุฌุฉ ุฃูู ูุง ูููู ุชุฎุฒูููุง ุญุชู ุนูู ุงููุฑุต ุงูุตูุจ ูุฌูุงุฒ ุงูููุจููุชุฑ ุงููุญููู ุงูุฎุงุต ุจู. ุนูู ุณุจูู ุงููุซุงูุ ุฅุฐุง ุญุงูููุง ุชูุฒูู The Pile ุจุงููุงููุ ูุณูุญุชุงุฌ ุฅูู 825 ุฌูุฌุงุจุงูุช ูู ูุณุงุญุฉ ุงููุฑุต ุงููุงุฑุบุฉ! ููุชุนุงูู ูุน ูุฐู ุงูุญุงูุงุชุ ุชููุฑ ููุชุจุฉ ๐ค Datasets ููุฒุฉ ุงูุจุซ ุงูุชู ุชุชูุญ ููุง ุชูุฒูู ุงูุนูุงุตุฑ ูุงููุตูู ุฅูููุง ุฃุซูุงุก ุงูุชูููุ ุฏูู ุงูุญุงุฌุฉ ุฅูู ุชูุฒูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุงููุงูู. ุฏุนูุง ูููู ูุธุฑุฉ ุนูู ููููุฉ ุนูู ุฐูู.

<Tip>

๐ก ูู ุฏูุงุชุฑ Jupyter ููููู ุฃูุถูุง ุชูููุช ุงูุฎูุงูุง ุจุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูุณุญุฑูุฉ [`%%timeit` magic function](https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-timeit).

</Tip>

## ูุฌููุนุงุช ุงูุจูุงูุงุช ุงูููุชุฏููุฉ [[streaming-datasets]]

ูุชูููู ุจุซ ูุฌููุนุฉ ุงูุจูุงูุงุชุ ูู ูุง ุนููู ูุนูู ูู ุชูุฑูุฑ ุงูุญุฌุฉ `streaming=True` ุฅูู ุฏุงูุฉ `load_dataset()`. ุนูู ุณุจูู ุงููุซุงูุ ุฏุนูุง ูุญูู ูุฌููุนุฉ ุจูุงูุงุช PubMed Abstracts ูุฑุฉ ุฃุฎุฑูุ ูููู ูู ูุถุน ุงูุจุซ:

```py
pubmed_dataset_streamed = load_dataset(
    "json", data_files=data_files, split="train", streaming=True
)
```

ุจุฏูุงู ูู `Dataset` ุงููุฃููู ุงูุฐู ุตุงุฏููุงู ูู ุฃูุงูู ุฃุฎุฑู ูู ูุฐุง ุงููุตูุ ูุฅู ุงููุงุฆู ุงูุฐู ูุชู ุฅุฑุฌุงุนู ูุน `streaming=True` ูู `IterableDataset`. ููุง ููุญู ุงูุงุณูุ ูููุตูู ุฅูู ุนูุงุตุฑ `IterableDataset`ุ ูุญุชุงุฌ ุฅูู ุงูุชูุฑุงุฑ ุนููู. ูููููุง ุงููุตูู ุฅูู ุงูุนูุตุฑ ุงูุฃูู ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูููุชุฏููุฉ ุนูู ุงููุญู ุงูุชุงูู:


```py
next(iter(pubmed_dataset_streamed))
```

```python out
{'meta': {'pmid': 11409574, 'language': 'eng'},
 'text': 'ูุจุงุฆูุงุช ููุต ุงูุฃูุณุฌุฉ ูู ุงูุฃุทูุงู ุงููุตุงุจูู ุจุงูุชูุงุจุงุช ุงูุฌูุงุฒ ุงูุชููุณู ุงูุณููู ุงูุญุงุฏุฉ.\nูุชุญุฏูุฏ ูุฏู ุงูุชุดุงุฑ ููุต ุงูุฃูุณุฌุฉ ูู ุงูุฃุทูุงู ุงูุฐูู ุชูู ุฃุนูุงุฑูู ุนู 5 ุณููุงุช ูุงูุฐูู ูุนุงููู ูู ุงูุชูุงุจุงุช ุงูุฌูุงุฒ ุงูุชููุณู ุงูุณููู ุงูุญุงุฏุฉ (ALRI)ุ ูุนูุงูู ุงูุฎุทุฑ ูููุต ุงูุฃูุณุฌุฉ ูู ุงูุฃุทูุงู ุงูุฐูู ุชูู ุฃุนูุงุฑูู ุนู 5 ุณููุงุช ูุงูุฐูู ูุนุงููู ูู ALRIุ ูุนูุงูุฉ ููุต ุงูุฃูุณุฌุฉ ุจุฒูุงุฏุฉ ุฎุทุฑ ุงูููุงุฉ ูู ุงูุฃุทูุงู ูู ููุณ ุงูุนูุฑ ...'}
```

ูููู ูุนุงูุฌุฉ ุงูุนูุงุตุฑ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูููุชุฏููุฉ ุฃุซูุงุก ุงูุชููู ุจุงุณุชุฎุฏุงู `IterableDataset.map()`ุ ููู ุฃูุฑ ูููุฏ ุฃุซูุงุก ุงูุชุฏุฑูุจ ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุชูุณูู ุงููุฏุฎูุงุช ุฅูู ุฑููุฒ. ุงูุนูููุฉ ูู ููุณูุง ุชูุงููุง ุงูุชู ุงุณุชุฎุฏููุงูุง ูุชูุณูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูุง ุฅูู ุฑููุฒ ูู [ุงููุตู 3](/course/chapter3)ุ ูุน ุงูุงุฎุชูุงู ุงููุญูุฏ ูู ุฃู ุงููุฎุฑุฌุงุช ูุชู ุฅุฑุฌุงุนูุง ูุงุญุฏูุง ุชูู ุงูุขุฎุฑ:

```py
from transformers import AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained("distilbert-base-uncased")
tokenized_dataset = pubmed_dataset_streamed.map(lambda x: tokenizer(x["text"]))
next(iter(tokenized_dataset))
```

```python out
{'input_ids': [101, 4958, 5178, 4328, 6779, ...], 'attention_mask': [1, 1, 1, 1, 1, ...]}
```

<Tip>

๐ก ูุชุณุฑูุน ุนูููุฉ ุชูุณูู ุงููุฏุฎูุงุช ุฅูู ุฑููุฒ ูุน ุงูุจุซุ ููููู ุชูุฑูุฑ `batched=True`ุ ููุง ุฑุฃููุง ูู ุงููุณู ุงูุฃุฎูุฑ. ุณุชุนุงูุฌ ุงูุฃูุซูุฉ ุฏูุนุฉ ุชูู ุงูุฃุฎุฑูุ ุญุฌู ุงูุฏูุนุฉ ุงูุงูุชุฑุงุถู ูู 1,000 ููููู ุชุญุฏูุฏู ุจุงุณุชุฎุฏุงู ุญุฌุฉ `batch_size`.

</Tip>

ููููู ุฃูุถูุง ุฎูุท ูุฌููุนุฉ ุจูุงูุงุช ููุชุฏููุฉ ุจุงุณุชุฎุฏุงู `IterableDataset.shuffle()`ุ ูููู ุนูู ุนูุณ `Dataset.shuffle()`ุ ูุฅู ูุฐุง ูุฎูุท ุงูุนูุงุตุฑ ููุท ูู ุญุฌู ููุญุฏุฏ ูุณุจููุง `buffer_size`:

```py
shuffled_dataset = pubmed_dataset_streamed.shuffle(buffer_size=10_000, seed=42)
next(iter(shuffled_dataset))
```

```python out
{'meta': {'pmid': 11410799, 'language': 'eng'},
 'text': 'ุฏุฑุงุณุฉ ุนุดูุงุฆูุฉ ูุชุนุฏูู ุงูุฌุฑุนุฉ ุฃู ุงูุฌุฏูู ุงูุฒููู ูุนุงูู ุชุญููุฒ ูุณุชุนูุฑุงุช ุงูุฎูุงูุง ุงููุญุจุจุฉ ูู ุงูุนูุงุฌ ุงูููููุงุฆู ุงููุงุฆู ุนูู ุงูุจูุงุชูู ููุฑุถู ูุจุงุฑ ุงูุณู ุงููุตุงุจูู ุจุณุฑุทุงู ุงูุฑุฆุฉ ...'}
```

ูู ูุฐุง ุงููุซุงูุ ูููุง ุจุงุฎุชูุงุฑ ูุซุงู ุนุดูุงุฆู ูู ุฃูู 10,000 ูุซุงู ูู ุงููุฎุฒู ุงููุคูุช. ุจูุฌุฑุฏ ุงููุตูู ุฅูู ูุซุงูุ ูุชู ููุก ููุงูู ูู ุงููุฎุฒู ุงููุคูุช ุจุงููุซุงู ุงูุชุงูู ูู ุงูููุฑุณ (ุฃู ุงููุซุงู ุฑูู 10,001 ูู ุงูุญุงูุฉ ุฃุนูุงู). ููููู ุฃูุถูุง ุชุญุฏูุฏ ุนูุงุตุฑ ูู ูุฌููุนุฉ ุจูุงูุงุช ููุชุฏููุฉ ุจุงุณุชุฎุฏุงู ุฏุงูุชูู `IterableDataset.take()` ู`IterableDataset.skip()`ุ ุงููุชูู ุชุนููุงู ุจุทุฑููุฉ ููุงุซูุฉ ูู `Dataset.select()`. ุนูู ุณุจูู ุงููุซุงูุ ูุงุฎุชูุงุฑ ุฃูู 5 ุฃูุซูุฉ ูู ูุฌููุนุฉ ุจูุงูุงุช PubMed Abstracts ูููููุง ุงูููุงู ุจูุง ููู:

```py
dataset_head = pubmed_dataset_streamed.take(5)
list(dataset_head)
```

```python out
[{'meta': {'pmid': 11409574, 'language': 'eng'},
  'text': 'ูุจุงุฆูุงุช ููุต ุงูุฃูุณุฌุฉ ูู ุงูุฃุทูุงู ุงููุตุงุจูู ุจุงูุชูุงุจุงุช ุงูุฌูุงุฒ ุงูุชููุณู ุงูุณููู ุงูุญุงุฏุฉ ...'},
 {'meta': {'pmid': 11409575, 'language': 'eng'},
  'text': 'ุนูุงูุงุช ุณุฑูุฑูุฉ ูููุต ุงูุฃูุณุฌุฉ ูู ุงูุฃุทูุงู ุงููุตุงุจูู ุจุงูุชูุงุจุงุช ุงูุฌูุงุฒ ุงูุชููุณู ุงูุณููู ุงูุญุงุฏุฉ: ูุคุดุฑุงุช ุงูุนูุงุฌ ุจุงูุฃูุณุฌูู ...'},
 {'meta': {'pmid': 11409576, 'language': 'eng'},
  'text': "ููุต ุงูุฃูุณุฌุฉ ูู ุงูุฃุทูุงู ุงููุตุงุจูู ุจุงูุงูุชูุงุจ ุงูุฑุฆูู ุงูุดุฏูุฏ ูู ุจุงุจูุง ุบูููุง ุงูุฌุฏูุฏุฉ ..."},
 {'meta': {'pmid': 11409577, 'language': 'eng'},
  'text': 'ูููุฏุงุช ุงูุฃูุณุฌูู ูุงูุฃุณุทูุงูุงุช ...'},
 {'meta': {'pmid': 11409578, 'language': 'eng'},
  'text': 'ุฅูุฏุงุฏุงุช ุงูุฃูุณุฌูู ูู ุฃูุฑูููุง ุงูุฑูููุฉ: ุชุฌุฑุจุฉ ุดุฎุตูุฉ ...'}]
```

ูุจุงููุซูุ ููููู ุงุณุชุฎุฏุงู ุฏุงูุฉ `IterableDataset.skip()` ูุฅูุดุงุก ุฃูุณุงู ุชุฏุฑูุจ ูุชุญูู ูู ูุฌููุนุฉ ุจูุงูุงุช ูุฎุชูุทุฉ ุนูู ุงููุญู ุงูุชุงูู:

```py
# ุชุฎุทู ุฃูู 1,000 ูุซุงู ูุฅุฏุฑุงุฌ ุงูุจุงูู ูู ูุฌููุนุฉ ุจูุงูุงุช ุงูุชุฏุฑูุจ
train_dataset = shuffled_dataset.skip(1000)
# ุฎุฐ ุฃูู 1,000 ูุซุงู ููุฌููุนุฉ ุจูุงูุงุช ุงูุชุญูู
validation_dataset = shuffled_dataset.take(1000)
```

ุฏุนูุง ูุฎุชุชู ุงุณุชูุดุงููุง ูุจุซ ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุชุทุจูู ุดุงุฆุน: ุฏูุฌ ูุฌููุนุงุช ุจูุงูุงุช ูุชุนุฏุฏุฉ ูุนูุง ูุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ูุงุญุฏุฉ. ุชููุฑ ููุชุจุฉ ๐ค Datasets ุฏุงูุฉ `interleave_datasets()` ุงูุชู ุชุญูู ูุงุฆูุฉ ูู ูุงุฆูุงุช `IterableDataset` ุฅูู `IterableDataset` ูุงุญุฏุ ุญูุซ ูุชู ุงูุญุตูู ุนูู ุนูุงุตุฑ ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ุนู ุทุฑูู ุงูุชูุงูุจ ุจูู ุงูุฃูุซูุฉ ุงููุตุฏุฑ. ูุฐู ุงูุฏุงูุฉ ูููุฏุฉ ุจุดูู ุฎุงุต ุนูุฏูุง ุชุญุงูู ุฏูุฌ ูุฌููุนุงุช ุจูุงูุงุช ูุจูุฑุฉุ ูุฐูู ููุซุงูุ ุฏุนูุง ูุจุซ ูุฌููุนุฉ ุจูุงูุงุช FreeLaw ุงููุฑุนูุฉ ูู The Pileุ ููู ูุฌููุนุฉ ุจูุงูุงุช ุจุญุฌู 51 ุฌูุฌุงุจุงูุช ูู ุงูุขุฑุงุก ุงููุงููููุฉ ูู ุงููุญุงูู ุงูุฃูุฑูููุฉ:

```py
law_dataset_streamed = load_dataset(
    "json",
    data_files="https://the-eye.eu/public/AI/pile_preliminary_components/FreeLaw_Opinions.jsonl.zst",
    split="train",
    streaming=True,
)
next(iter(law_dataset_streamed))
```

```python out
{'meta': {'case_ID': '110921.json',
  'case_jurisdiction': 'scotus.tar.gz',
  'date_created': '2010-04-28T17:12:49Z'},
 'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}
```

ูุฐู ุงููุฌููุนุฉ ูู ุงูุจูุงูุงุช ูุจูุฑุฉ ุจูุง ูููู ูุชุดูู ุถุบุทูุง ุนูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ููุนุธู ุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุงููุญูููุฉุ ููุน ุฐูู ุชูููุง ูู ุชุญููููุง ูุงููุตูู ุฅูููุง ุฏูู ุฃู ุฌูุฏ! ุฏุนูุง ุงูุขู ูุฏูุฌ ุงูุฃูุซูุฉ ูู ูุฌููุนุฉ ุจูุงูุงุช FreeLaw ูPubMed Abstracts ุจุงุณุชุฎุฏุงู ุฏุงูุฉ `interleave_datasets()`:

```py
from itertools import islice
from datasets import interleave_datasets

combined_dataset = interleave_datasets([pubmed_dataset_streamed, law_dataset_streamed])
list(islice(combined_dataset, 2))
```

```python out
[{'meta': {'pmid': 11409574, 'language': 'eng'},
  'text': 'ูุจุงุฆูุงุช ููุต ุงูุฃูุณุฌุฉ ูู ุงูุฃุทูุงู ุงููุตุงุจูู ุจุงูุชูุงุจุงุช ุงูุฌูุงุฒ ุงูุชููุณู ุงูุณููู ุงูุญุงุฏุฉ ...'},
 {'meta': {'case_ID': '110921.json',
   'case_jurisdiction': 'scotus.tar.gz',
   'date_created': '2010-04-28T17:12:49Z'},
  'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}]
```

ููุง ุงุณุชุฎุฏููุง ุฏุงูุฉ `islice()` ูู ูุญุฏุฉ `itertools` ูู ุจุงูุซูู ูุงุฎุชูุงุฑ ุฃูู ูุซุงููู ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงููุฌูุนุฉุ ููููููุง ุฃู ูุฑู ุฃููุง ุชุชุทุงุจู ูุน ุงูุฃูุซูุฉ ุงูุฃููู ูู ูู ูู ูุฌููุนุชู ุงูุจูุงูุงุช ุงููุตุฏุฑูุชูู.

ุฃุฎูุฑุงูุ ุฅุฐุง ููุช ุชุฑูุฏ ุจุซ "The Pile" ุจุญุฌููุง ุงููุงูู ุงูุจุงูุบ 825 ุฌูุฌุงุจุงูุชุ ููููู ุงูุญุตูู ุนูู ุฌููุน ุงููููุงุช ุงููุนุฏุฉ ุนูู ุงููุญู ุงูุชุงูู:

```py
base_url = "https://the-eye.eu/public/AI/pile/"
data_files = {
    "train": [base_url + "train/" + f"{idx:02d}.jsonl.zst" for idx in range(30)],
    "validation": base_url + "val.jsonl.zst",
    "test": base_url + "test.jsonl.zst",
}
pile_dataset = load_dataset("json", data_files=data_files, streaming=True)
next(iter(pile_dataset["train"]))
```

```python out
{'meta': {'pile_set_name': 'Pile-CC'},
 'text': 'ุชู ุฐููุ ูุชู ุชูุฏููู. ููููู ูุนุจ "Survival of the Tastiest" ุนูู ูุธุงู ุฃูุฏุฑููุฏุ ูุนูู ุงูููุจ...'}
```

<Tip>

โ๏ธ **ุฌุฑุจูุง!** ุงุณุชุฎุฏู ุฅุญุฏู ุงููุฌููุนุงุช ุงููุจูุฑุฉ ูู Common Crawl ูุซู [`mc4`](https://huggingface.co/datasets/mc4) ุฃู [`oscar`](https://huggingface.co/datasets/oscar) ูุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ูุชุนุฏุฏุฉ ุงููุบุงุช ููุจุซ ุงููุจุงุดุฑ ุชูุซู ุงููุณุจ ุงูููุทููุฉ ููุบุงุช ูู ุจูุฏ ุชุฎุชุงุฑู. ุนูู ุณุจูู ุงููุซุงูุ ุงููุบุงุช ุงููุทููุฉ ุงูุฃุฑุจุน ูู ุณููุณุฑุง ูู ุงูุฃููุงููุฉ ูุงููุฑูุณูุฉ ูุงูุฅูุทุงููุฉ ูุงูุฑููุงูุดูุฉุ ูุฐุง ููููู ุชุฌุฑุจุฉ ุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ุณููุณุฑูุฉ ุนู ุทุฑูู ุฃุฎุฐ ุนููุงุช ูู ูุฌููุนุงุช Oscar ุงููุฑุนูุฉ ููููุง ููุณุจุชูุง ุงูููุทููุฉ.

</Tip>

ุงูุขู ูุฏูู ุฌููุน ุงูุฃุฏูุงุช ุงูุชู ุชุญุชุงุฌูุง ูุชุญููู ููุนุงูุฌุฉ ูุฌููุนุงุช ุงูุจูุงูุงุช ุจุฌููุน ุฃุดูุงููุง ูุฃุญุฌุงููุง -- ูููู ูุง ูู ุชูู ูุญุธูุธูุง ุจุดูู ุงุณุชุซูุงุฆูุ ูุณุชุฃุชู ููุทุฉ ูู ุฑุญูุชู ูู NLP ุญูุซ ุณูุชุนูู ุนููู ุจุงููุนู ุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ูุญู ุงููุดููุฉ ุงููุทุฑูุญุฉ. ูุฐุง ูู ููุถูุน ุงููุณู ุงูุชุงูู!
