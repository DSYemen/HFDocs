<!--ุญููู ุงููุดุฑ 2023 ูุฑูู ูุงุฌููุฌ ููุณ. ุฌููุน ุงูุญููู ูุญููุธุฉ.

ูุฑุฎุต ุจููุฌุจ ุฑุฎุตุฉ ุฃุจุงุชุดูุ ุงูุฅุตุฏุงุฑ 2.0 (ุงูุฑุฎุตุฉ)ุ ูุง ูุฌูุฒ ูู ุงุณุชุฎุฏุงู ูุฐุง ุงูููู ุฅูุง ุจุงูุงูุชุซุงู ูู
ุงูุฑุฎุตุฉ. ููููู ุงูุญุตูู ุนูู ูุณุฎุฉ ูู ุงูุฑุฎุตุฉ ุนูู

http://www.apache.org/licenses/LICENSE-2.0

ูุง ูู ูุชุทูุจ ุงููุงููู ุงููุนููู ุจู ุฃู ูุชู ุงูุงุชูุงู ุนููู ูุชุงุจููุงุ ูุชู ุชูุฒูุน ุงูุจุฑุงูุฌ ุงูููุฒุนุฉ ุจููุฌุจ ุงูุฑุฎุตุฉ ุนูู
ุฃุณุงุณ "ููุง ูู" ุจุฏูู ุถูุงูุงุช ุฃู ุดุฑูุท ูู ุฃู ููุนุ ุณูุงุก ูุงูุช ุตุฑูุญุฉ ุฃู ุถูููุฉ. ุฑุงุฌุน ุงูุฑุฎุตุฉ ููุญุตูู ุนูู
ุงููุบุฉ ุงููุญุฏุฏุฉ ุงูุชู ุชุญูู ุงูุฃุฐููุงุช ูุงููููุฏ ุจููุฌุจ ุงูุฑุฎุตุฉ.

โ๏ธ ูุฑุฌู ููุงุญุธุฉ ุฃู ูุฐุง ุงูููู ููุชูุจ ุจูุบุฉ Markdown ููููู ูุญุชูู ุนูู ุจูุงุก ุฌููุฉ ูุญุฏุฏุฉ ููุจูู ุงููุซุงุฆู ุงูุฎุงุต ุจูุง (ูุดุจู MDX) ูุงูุฐู ูุฏ ูุง ูุชู
ุนุฑุถู ุจุดูู ุตุญูุญ ูู ุนุงุฑุถ Markdown ุงูุฎุงุต ุจู.

-->

# ููุงู ุงูุตูุฑ ูุน IDEFICS

[[open-in-colab]]

ูู ุญูู ูููู ูุนุงูุฌุฉ ุงูููุงู ุงููุฑุฏูุฉ ูู ุฎูุงู ุงูุถุจุท ุงูุฏููู ููููุงุฐุฌ ุงููุชุฎุตุตุฉุ ููุฏ ุธูุฑ ููุฌ ุจุฏูู
ุงูุชุณุจ ุดุนุจูุฉ ูุคุฎุฑูุง ููู ุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ุงููุจูุฑุฉ ููุฌููุนุฉ ูุชููุนุฉ ูู ุงูููุงู ุจุฏูู ุถุจุท ุฏููู.
ุนูู ุณุจูู ุงููุซุงูุ ูููู ููููุงุฐุฌ ุงููุบููุฉ ุงููุจูุฑุฉ ุงูุชุนุงูู ูุน ููุงู NLP ูุซู ุงูุชูุฎูุต ูุงูุชุฑุฌูุฉ ูุงูุชุตููู ูุงููุฒูุฏ.
ูู ูุนุฏ ูุฐุง ุงูููุฌ ููุชุตุฑูุง ุนูู ููุท ูุงุญุฏุ ูุซู ุงููุตุ ููู ูุฐุง ุงูุฏูููุ ุณูุดุฑุญ ููู ููููู
ุญู ููุงู ุงูุตูุฑ ูุงููุตูุต ุจุงุณุชุฎุฏุงู ูููุฐุฌ ูุชุนุฏุฏ ุงููุณุงุฆุท ูุจูุฑ ูุณูู IDEFICS.

[IDEFICS](../model_doc/idefics) ูู ูููุฐุฌ ููุชูุญ ุงููุตูู ููุฑุคูุฉ ูุงููุบุฉ ูุนุชูุฏ ุนูู [Flamingo](https://huggingface.co/papers/2204.14198)ุ
ูููุฐุฌ ูุบุฉ ุจุตุฑูุฉ ุฑุงุฆุฏ ุชู ุชุทููุฑู ูู ุงูุจุฏุงูุฉ ุจูุงุณุทุฉ DeepMind. ููุจู ุงููููุฐุฌ ุชุณูุณูุงุช ุชุนุณููุฉ ูู ุงูุตูุฑ
ููุตูุต ุงูุฅุฏุฎุงู ูููุชุฌ ูุตูุง ูุชูุงุณููุง ููุงุชุฌ. ููููู ุงูุฅุฌุงุจุฉ ุนู ุงูุฃุณุฆูุฉ ุญูู ุงูุตูุฑ ููุตู ุงููุญุชูู ุงููุฑุฆู
ูุฅูุดุงุก ูุตุต ูุจููุฉ ุนูู ุตูุฑ ูุชุนุฏุฏุฉุ ูููุฐุง. ูุฃุชู IDEFICS ูู ูุณุฎุชูู - [80 ูููุงุฑ ูุนุงูู](https://huggingface.co/HuggingFaceM4/idefics-80b)
ู [9 ูููุงุฑ ูุนุงูู](https://huggingface.co/HuggingFaceM4/idefics-9b)ุ ูููุงููุง ูุชุงุญุงู ุนูู ๐ค Hub. ุจุงููุณุจุฉ ููู ูุณุฎุฉุ ููููู ุฃูุถูุง ุงูุนุซูุฑ ุนูู ูุณุฎ ูุถุจูุทุฉ ุจุฏูุฉ
ูู ุงููููุฐุฌ ุงููููู ูุญุงูุงุช ุงูุงุณุชุฎุฏุงู ุงููุญุงุฏุซูุฉ.

ูุฐุง ุงููููุฐุฌ ูุชุนุฏุฏ ุงูุงุณุชุฎุฏุงูุงุช ุจุดูู ุงุณุชุซูุงุฆู ููููู ุงุณุชุฎุฏุงูู ููุฌููุนุฉ ูุงุณุนุฉ ูู ููุงู ุงูุตูุฑ ูุงููุณุงุฆุท ุงููุชุนุฏุฏุฉ. ููุน ุฐููุ
ูููู ูููุฐุฌูุง ูุจูุฑูุง ูุนูู ุฃูู ูุชุทูุจ ููุงุฑุฏ ุญุณุงุจูุฉ ูุจููุฉ ุชุญุชูุฉ ูุจูุฑุฉ. ุงูุฃูุฑ ูุชุฑูู ูู ูุชูุฑุฑ ูุง ุฅุฐุง ูุงู
ูุฐุง ุงูููุฌ ููุงุณุจ ุญุงูุชู ุงูุงุณุชุฎุฏุงููุฉ ุจุดูู ุฃูุถู ูู ุงูุถุจุท ุงูุฏููู ููููุงุฐุฌ ุงููุชุฎุตุตุฉ ููู ูููุฉ ูุฑุฏูุฉ.

ูู ูุฐุง ุงูุฏูููุ ุณุชุชุนูู ููููุฉ:
- [ุชุญููู IDEFICS](#ุชุญููู-ุงููููุฐุฌ) ู [ุชุญููู ุงููุณุฎุฉ ุงููููุฉ ูู ุงููููุฐุฌ](#ุงููููุฐุฌ-ุงูููู)
- ุงุณุชุฎุฏุงู IDEFICS ูู:
  - [ูุถุน ุนููุงู ููุตูุฑุฉ](#ูุถุน-ุนููุงู-ููุตูุฑุฉ)
  - [ูุถุน ุนููุงู ููุตูุฑุฉ ุจูุญูุฒ](#ูุถุน-ุนููุงู-ููุตูุฑุฉ-ุจูุญูุฒ)
  - [ุงูุชุญููุฒ ุงููููู](#ุงูุชุญููุฒ-ุงููููู)
  - [ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงูุจุตุฑูุฉ](#ุงูุฅุฌุงุจุฉ-ุนูู-ุงูุฃุณุฆูุฉ-ุงูุจุตุฑูุฉ)
  - [ุชุตููู ุงูุตูุฑ](#ุชุตููู-ุงูุตูุฑ)
  - [ุฅูุดุงุก ูุต ููุฌู ุจุงูุตูุฑ](#ุฅูุดุงุก-ูุต-ููุฌู-ุจุงูุตูุฑ)
- [ุชุดุบูู ุงูุงุณุชูุชุงุฌ ูู ูุถุน ุงูุฏูุนุงุช](#ุชุดุบูู-ุงูุงุณุชูุชุงุฌ-ูู-ูุถุน-ุงูุฏูุนุงุช)
- [ุชุดุบูู IDEFICS ููุชุนูููุงุช ููุงุณุชุฎุฏุงู ุงููุญุงุฏุซู](#IDEFICS-ููุฅุฑุดุงุฏ-ููุงุณุชุฎุฏุงู-ุงููุญุงุฏุซู)

ูุจู ุฃู ุชุจุฏุฃุ ุชุฃูุฏ ูู ุชุซุจูุช ุฌููุน ุงูููุชุจุงุช ุงูุถุฑูุฑูุฉ.

```bash
pip install -q bitsandbytes sentencepiece accelerate transformers
```

<Tip>
ูุชุดุบูู ุงูุฃูุซูุฉ ุงูุชุงููุฉ ุจุงุณุชุฎุฏุงู ูุณุฎุฉ ุบูุฑ ูููุฉ ูู ููุทุฉ ุชูุชูุด ุงููููุฐุฌุ ุณุชุญุชุงุฌ ุฅูู 20 ุฌูุฌุงุจุงูุช ุนูู ุงูุฃูู ูู ุฐุงูุฑุฉ GPU.
</Tip>

## ุชุญููู ุงููููุฐุฌ

ุฏุนูุง ูุจุฏุฃ ุจุชุญููู ููุทุฉ ุชูุชูุด ูุนุงููุงุช ุงููููุฐุฌ ุงูุจุงูุบุฉ 9 ูููุงุฑ:

```py
>>> checkpoint = "HuggingFaceM4/idefics-9b"
```

ูุซู ููุงุฐุฌ ุงููุญููุงุช ุงูุฃุฎุฑูุ ุชุญุชุงุฌ ุฅูู ุชุญููู ูุนุงูุฌ ูุงููููุฐุฌ ููุณู ูู ููุทุฉ ุงูุชูุชูุด.
ูุบูู ูุนุงูุฌ IDEFICS [`LlamaTokenizer`] ููุนุงูุฌ ุตูุฑ IDEFICS ูู ูุนุงูุฌ ูุงุญุฏ ููุงูุชูุงู ุจู
ุฅุนุฏุงุฏ ุฅุฏุฎุงูุงุช ุงููุต ูุงูุตูุฑ ูููููุฐุฌ.

```py
>>> import torch

>>> from transformers import IdeficsForVisionText2Text, AutoProcessor

>>> processor = AutoProcessor.from_pretrained(checkpoint)

>>> model = IdeficsForVisionText2Text.from_pretrained(checkpoint, torch_dtype=torch.bfloat16, device_map="auto")
```

ุณูุญุฏุฏ ุชุนููู `device_map` ุฅูู `"auto"` ุชููุงุฆููุง ููููุฉ ุชุญููู ูุชุฎุฒูู ุฃูุฒุงู ุงููููุฐุฌ ุจุงูุทุฑููุฉ ุงูุฃูุซุฑ ุชุญุณูููุง
ุทุฑููุฉ ุจุงููุธุฑ ุฅูู ุงูุฃุฌูุฒุฉ ุงูููุฌูุฏุฉ.

### ุงููููุฐุฌ ุงูููู

ุฅุฐุง ูุงูุช ูุดููุฉ ุชููุฑ ุฐุงูุฑุฉ GPU ุนุงููุฉุ ูููููู ุชุญููู ุงููุณุฎุฉ ุงููููุฉ ูู ุงููููุฐุฌ. ูุชุญููู ุงููููุฐุฌ ู
ุงููุนุงูุฌ ุจุฏูุฉ 4 ุจุชุ ูู ุจุชูุฑูุฑ `BitsAndBytesConfig` ุฅูู ุทุฑููุฉ `from_pretrained` ูุณูุชู ุถุบุท ุงููููุฐุฌ
ุฃุซูุงุก ุงูุชุญููู.

```py
>>> import torch
>>> from transformers import IdeficsForVisionText2Text, AutoProcessor, BitsAndBytesConfig

>>> quantization_config = BitsAndBytesConfig(
...     load_in_4bit=True,
...     bnb_4bit_compute_dtype=torch.float16,
... )

>>> processor = AutoProcessor.from_pretrained(checkpoint)

>>> model = IdeficsForVisionText2Text.from_pretrained(
...     checkpoint,
...     quantization_config=quantization_config,
...     device_map="auto"
... )
```

ุงูุขู ุจุนุฏ ุฃู ููุช ุจุชุญููู ุงููููุฐุฌ ุจุฅุญุฏู ุงูุทุฑู ุงูููุชุฑุญุฉุ ุฏุนูุง ููุชูู ุฅูู ุงุณุชูุดุงู ุงูููุงู ุงูุชู ููููู ุงุณุชุฎุฏุงู IDEFICS ููุง.

## ูุถุน ุนููุงู ููุตูุฑุฉ
ูุถุน ุนููุงู ููุตูุฑุฉ ูู ูููุฉ ุงูุชูุจุค ุจุนููุงู ูุตูุฑุฉ ูุนููุฉ. ุฃุญุฏ ุงูุชุทุจููุงุช ุงูุดุงุฆุนุฉ ูู ูุณุงุนุฏุฉ ุงูุฃุดุฎุงุต ุถุนุงู ุงูุจุตุฑ
ุงูุชููู ุนุจุฑ ููุงูู ูุฎุชููุฉุ ุนูู ุณุจูู ุงููุซุงูุ ุงุณุชูุดุงู ูุญุชูู ุงูุตูุฑ ุนุจุฑ ุงูุฅูุชุฑูุช.

ูุชูุถูุญ ุงููููุฉุ ุงุญุตู ุนูู ุตูุฑุฉ ููุถุน ุนููุงู ููุงุ ุนูู ุณุจูู ุงููุซุงู:

<div class="flex justify-center">
     <img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/tasks/idefics-im-captioning.jpg" alt="ุตูุฑุฉ ุฌุฑู ูู ุณุฑูุฑ ูู ุงูุฒููุฑ"/>
</div>

ุตูุฑุฉ ุจูุงุณุทุฉ [Hendo Wang](https://unsplash.com/@hendoo).

ููุจู IDEFICS ูุญูุฒุงุช ุงููุต ูุงูุตูุฑ. ููุน ุฐููุ ููุถุน ุนููุงู ูุตูุฑุฉุ ูุง ูุชุนูู ุนููู ุชูููุฑ ูุญูุฒ ูุตู ูููููุฐุฌุ ููุท
ุฅุฏุฎุงู ุงูุตูุฑุฉ ุงููุนุงูุฌุฉ ูุณุจููุง. ุจุฏูู ูุญูุฒ ูุตูุ ุณูุจุฏุฃ ุงููููุฐุฌ ูู ุชูููุฏ ุงููุต ูู
ุฑูุฒ BOS (ุจุฏุงูุฉ ุงูุชุณูุณู) ูุจุงูุชุงูู ุฅูุดุงุก ุนููุงู.

ูุฅุฏุฎุงู ุตูุฑุฉ ูููููุฐุฌุ ููููู ุงุณุชุฎุฏุงู ุฅูุง ูุงุฆู ุตูุฑุฉ (`PIL.Image`) ุฃู ุนููุงู URL ูููู ุงุณุชุฑุฏุงุฏ ุงูุตูุฑุฉ ููู.

```py
>>> prompt = [
...     "https://images.unsplash.com/photo-1583160247711-2191776b4b91?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=3542&q=80",
... ]

>>> inputs = processor(prompt, return_tensors="pt").to("cuda")
>>> bad_words_ids = processor.tokenizer(["<image>", "<fake_token_around_image>"], add_special_tokens=False).input_ids

>>> generated_ids = model.generate(**inputs, max_new_tokens=10, bad_words_ids=bad_words_ids)
>>> generated_text = processor.batch_decode(generated_ids, skip_special_tokens=True)
>>> print(generated_text[0])
ุฌุฑู ูู ุณุฑูุฑ ูู ุงูุฒููุฑ
```
<Tip>

ูู ุงูุฌูุฏ ุชุถููู `bad_words_ids` ูู ุงูุงุณุชุฏุนุงุก ูู `generate` ูุชุฌูุจ ุงูุฃุฎุทุงุก ุงูุชู ุชุธูุฑ ุนูุฏ ุฒูุงุฏุฉ
`max_new_tokens`: ุญูุซ ุณุชุญุงูู ุงูููุงุฐุฌ ุชูููุฏ ุฑูุฒ `<image>` ุฃู `<fake_token_around_image>` ุฌุฏูุฏ ุนูุฏูุง ูุง ูููู ููุงู ุตูุฑุฉ ูุชู ุชูููุฏูุง ุจูุงุณุทุฉ ุงููููุฐุฌ.
ููููู ุถุจุทูุง ุฃุซูุงุก ุงูุชูููุฐ ููุง ูู ูุฐุง ุงูุฏูููุ ุฃู ุชุฎุฒูููุง ูู `GenerationConfig` ููุง ูู ููุถุญ ูู ุฏููู [ุงุณุชุฑุงุชูุฌูุงุช ุชูููุฏ ุงููุต](../generation_strategies).
</Tip>

## ูุชุงุจุฉ ุชุนููู ุนูู ุงูุตูุฑุฉ

ููููู ุชูุณูุน ูุชุงุจุฉ ุชุนููู ุนูู ุงูุตูุฑุฉ ูู ุฎูุงู ุชูููุฑ ูุต ููุฌูุ ูุงูุฐู ุณููููู ุงููููุฐุฌ ุจูุงุกู ุนูู ุงูุตูุฑุฉ. ุฏุนูุง ูุฃุฎุฐ
ุตูุฑุฉ ุฃุฎุฑู ููุชูุถูุญ:

<div class="flex justify-center">
     <img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/tasks/idefics-prompted-im-captioning.jpg" alt="ุตูุฑุฉ ูุจุฑุฌ ุฅููู ูู ุงูููู"/>
</div>

ุตูุฑุฉ ุจูุงุณุทุฉ [Denys Nevozhai](https://unsplash.com/@dnevozhai).

ูููู ุชูุฑูุฑ ุงููุต ูุงูุตูุฑ ุงูููุฌูุฉ ุฅูู ูุนุงูุฌ ุงููููุฐุฌ ููุงุฆูุฉ ูุงุญุฏุฉ ูุฅูุดุงุก ูุฏุฎูุงุช ููุงุณุจุฉ.

```py
>>> prompt = [
...     "https://images.unsplash.com/photo-1543349689-9a4d426bee8e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=3501&q=80",
...     "ูุฐู ุตูุฑุฉ ูู ",
... ]

>>> inputs = processor(prompt, return_tensors="pt").to("cuda")
>>> bad_words_ids = processor.tokenizer(["<image>", "<fake_token_around_image>"], add_special_tokens=False).input_ids

>>> generated_ids = model.generate(**inputs, max_new_tokens=10, bad_words_ids=bad_words_ids)
>>> generated_text = processor.batch_decode(generated_ids, skip_special_tokens=True)
>>> print(generated_text[0])
ูุฐู ุตูุฑุฉ ูุจุฑุฌ ุฅููู ูู ุจุงุฑูุณุ ูุฑูุณุง.
```

## ุงูุชูุฌูู ุงููููู

ุจูููุง ูุธูุฑ IDEFICS ูุชุงุฆุฌ ููุชุงุฒุฉ ุจุฏูู ุชูุฌููุ ูุฏ ุชุชุทูุจ ูููุชู ุชูุณูููุง ูุนูููุง ููุชุนูููุ ุฃู ุชุฃุชู
ุจูููุฏ ุฃู ูุชุทูุจุงุช ุฃุฎุฑู ุชุฒูุฏ ูู ุชุนููุฏ ุงููููุฉ. ูููู ุงุณุชุฎุฏุงู ุงูุชูุฌูู ุงููููู ูุชูููู ุงูุชุนูู ูู ุงูุณูุงู.
ูู ุฎูุงู ุชูููุฑ ุฃูุซูุฉ ูู ุงูุชูุฌููุ ููููู ุชูุฌูู ุงููููุฐุฌ ูุชูููุฏ ูุชุงุฆุฌ ุชุญุงูู ุชูุณูู ุงูุฃูุซูุฉ ุงููุนุทุงุฉ.

ุฏุนูุง ูุณุชุฎุฏู ุตูุฑุฉ ุจุฑุฌ ุฅููู ุงูุณุงุจูุฉ ููุซุงู ูููููุฐุฌ ููุจูู ุชูุฌูููุง ููุถุญ ูููููุฐุฌ
ุฃูู ุจุงูุฅุถุงูุฉ ุฅูู ุชุนูู ูุง ูู ุงูุดูุก ูู ุงูุตูุฑุฉุ ููุฏ ุฃูุถูุง ุงูุญุตูู ุนูู ุจุนุถ ุงููุนูููุงุช ุงููุซูุฑุฉ ููุงูุชูุงู ุญููู.
ุซู ุฏุนูุง ูุฑูุ ุฅุฐุง ูุงู ุจุฅููุงููุง ุงูุญุตูู ุนูู ููุณ ุชูุณูู ุงูุงุณุชุฌุงุจุฉ ูุตูุฑุฉ ุชูุซุงู ุงูุญุฑูุฉ:

<div class="flex justify-center">
     <img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/tasks/idefics-few-shot.jpg" alt="ุตูุฑุฉ ูุชูุซุงู ุงูุญุฑูุฉ"/>
</div>

ุตูุฑุฉ ุจูุงุณุทุฉ [Juan Mayobre](https://unsplash.com/@jmayobres).

```py
>>> prompt = ["ุงููุณุชุฎุฏู:",
...            "https://images.unsplash.com/photo-1543349689-9a4d426bee8e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=3501&q=80",
...            "ูุตู ูุฐู ุงูุตูุฑุฉ.\nุงููุณุงุนุฏ: ุตูุฑุฉ ูุจุฑุฌ ุฅููู ูู ุงูููู. ุญูููุฉ ููุชุนุฉ: ุจุฑุฌ ุฅููู ุจููุณ ุงุฑุชูุงุน ูุจูู ูููู ูู 81 ุทุงุจููุง.\n",
...            "ุงููุณุชุฎุฏู:",
...            "https://images.unsplash.com/photo-1524099163253-32b7f0256868?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=3387&q=80",
...            "ูุตู ูุฐู ุงูุตูุฑุฉ.\nุงููุณุงุนุฏ:"
...            ]

>>> inputs = processor(prompt, return_tensors="pt").to("cuda")
>>> bad_words_ids = processor.tokenizer(["<image>", "<fake_token_around_image>"], add_special_tokens=False).input_ids

>>> generated_ids = model.generate(**inputs, max_new_tokens=30, bad_words_ids=bad_words_ids)
>>> generated_text = processor.batch_decode(generated_ids, skip_special_tokens=True)
>>> print(generated_text[0])
ุงููุณุชุฎุฏู: ูุตู ูุฐู ุงูุตูุฑุฉ.
ุงููุณุงุนุฏ: ุตูุฑุฉ ูุจุฑุฌ ุฅููู ูู ุงูููู. ุญูููุฉ ููุชุนุฉ: ุจุฑุฌ ุฅููู ุจููุณ ุงุฑุชูุงุน ูุจูู ูููู ูู 81 ุทุงุจููุง.
ุงููุณุชุฎุฏู: ูุตู ูุฐู ุงูุตูุฑุฉ.
ุงููุณุงุนุฏ: ุตูุฑุฉ ูุชูุซุงู ุงูุญุฑูุฉ. ุญูููุฉ ููุชุนุฉ: ุชูุซุงู ุงูุญุฑูุฉ ูุจูุบ ุงุฑุชูุงุนู 151 ูุฏููุง.
```

ูุงุญุธ ุฃูู ูู ุฎูุงู ูุซุงู ูุงุญุฏ ููุท (ุฃูุ ุชูุฌูู ูุงุญุฏ)ุ ุชุนูู ุงููููุฐุฌ ููููุฉ ุฃุฏุงุก ุงููููุฉ. ุจุงููุณุจุฉ ููููุงู ุงูุฃูุซุฑ ุชุนููุฏูุงุ
ููููู ุชุฌุฑุจุฉ ุนุฏุฏ ุฃูุจุฑ ูู ุงูุฃูุซูุฉ (ูุซูุ 3 ุฃูุซูุฉุ 5 ุฃูุซูุฉุ ุฅูุฎ).

## ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงูุจุตุฑูุฉ

ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงูุจุตุฑูุฉ (VQA) ูู ูููุฉ ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงูููุชูุญุฉ ุจูุงุกู ุนูู ุตูุฑุฉ. ูุดุงุจูุฉ ููุชุงุจุฉ ุชุนููู ุนูู ุงูุตูุฑุฉุ ูููู ุงุณุชุฎุฏุงููุง ูู ุชุทุจููุงุช ุฅููุงููุฉ ุงููุตููุ ูููู ุฃูุถูุง ูู ุงูุชุนููู (ุงูุงุณุชุฏูุงู ุญูู ุงูููุงุฏ ุงููุฑุฆูุฉ)ุ ูุฎุฏูุฉ ุงูุนููุงุก (ุงูุฃุณุฆูุฉ ุญูู ุงูููุชุฌุงุช ุจูุงุกู ุนูู ุงูุตูุฑ)ุ ูุงุณุชุฑุฌุงุน ุงูุตูุฑ.

ุฏุนูุง ูุญุตู ุนูู ุตูุฑุฉ ุฌุฏูุฏุฉ ููุฐู ุงููููุฉ:

<div class="flex justify-center">
     <img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/tasks/idefics-vqa.jpg" alt="ุตูุฑุฉ ูุฒูุฌูู ูู ูุฒูุฉ"/>
</div>

ุตูุฑุฉ ุจูุงุณุทุฉ [Jarritos Mexican Soda](https://unsplash.com/@jarritos).

ููููู ุชูุฌูู ุงููููุฐุฌ ูู ูุชุงุจุฉ ุชุนููู ุนูู ุงูุตูุฑุฉ ุฅูู ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงูุจุตุฑูุฉ ูู ุฎูุงู ุชูุฌููู ุจุชุนูููุงุช ููุงุณุจุฉ:

```py
>>> prompt = [
...     "ุงูุชุนูููุงุช: ูุฏู ุฅุฌุงุจุฉ ููุณุคุงู. ุงุณุชุฎุฏู ุงูุตูุฑุฉ ููุฅุฌุงุจุฉ.\n",
...     "https://images.unsplash.com/photo-1623944889288-cd147dbb517c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=3540&q=80",
...     "ุงูุณุคุงู: ุฃูู ูุคูุงุก ุงูุฃุดุฎุงุต ููุง ูู ุงูุทูุณุ ุงูุฅุฌุงุจุฉ:"
... ]

>>> inputs = processor(prompt, return_tensors="pt").to("cuda")
>>> bad_words_ids = processor.tokenizer(["<image>", "<fake_token_around_image>"], add_special_tokens=False).input_ids

>>> generated_ids = model.generate(**inputs, max_new_tokens=20, bad_words_ids=bad_words_ids)
>>> generated_text = processor.batch_decode(generated_ids, skip_special_tokens=True)
>>> print(generated_text[0])
ุงูุชุนูููุงุช: ูุฏู ุฅุฌุงุจุฉ ููุณุคุงู. ุงุณุชุฎุฏู ุงูุตูุฑุฉ ููุฅุฌุงุจุฉ.
ุงูุณุคุงู: ุฃูู ูุคูุงุก ุงูุฃุดุฎุงุต ููุง ูู ุงูุทูุณุ ุงูุฅุฌุงุจุฉ: ุฅููู ูู ุญุฏููุฉ ูู ูุฏููุฉ ูููููุฑูุ ูุงูุทูุณ ุฌููู.
```
```
## ุชุตููู ุงูุตูุฑ

IDEFICS ูุงุฏุฑ ุนูู ุชุตููู ุงูุตูุฑ ุฅูู ูุฆุงุช ูุฎุชููุฉ ุฏูู ุชุฏุฑูุจ ุตุฑูุญ ุนูู ุจูุงูุงุช ุชุญุชูู ุนูู 
ุฃูุซูุฉ ูุตููุฉ ูู ุชูู ุงููุฆุงุช ุงููุญุฏุฏุฉ. ุนูุฏ ุฅุนุทุงุก ูุงุฆูุฉ ุจุงููุฆุงุช ูุงุณุชุฎุฏุงู ูุฏุฑุงุชู ุนูู ููู ุงูุตูุฑ ูุงููุตูุตุ 
ูููู ูููููุฐุฌ ุงุณุชูุชุงุฌ ุงููุฆุฉ ุงูุชู ูู ุงููุญุชูู ุฃู ุชูุชูู ุฅูููุง ุงูุตูุฑุฉ.

ูููุชุฑุถ ุฃู ูุฏููุง ูุฐู ุงูุตูุฑุฉ ูุทุงููุฉ ุฎุถุฑูุงุช:

<div class="flex justify-center">
     <img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/tasks/idefics-classification.jpg" alt="ุตูุฑุฉ ูุทุงููุฉ ุฎุถุฑูุงุช"/>
</div>

ุงูุตูุฑุฉ ูู [Peter Wendt](https://unsplash.com/@peterwendt).

ูููููุง ุชูุฌูู ุงููููุฐุฌ ูุชุตููู ุงูุตูุฑุฉ ุฅูู ูุงุญุฏุฉ ูู ุงููุฆุงุช ุงูุชู ูุฏููุง:

```py
>>> categories = ['animals','vegetables', 'city landscape', 'cars', 'office']
>>> prompt = [f"Instruction: Classify the following image into a single category from the following list: {categories}.\n",
...     "https://images.unsplash.com/photo-1471193945509-9ad0617afabf?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=3540&q=80",    
...     "Category: "
... ]

>>> inputs = processor(prompt, return_tensors="pt").to("cuda")
>>> bad_words_ids = processor.tokenizer(["<image>", "<fake_token_around_image>"], add_special_tokens=False).input_ids

>>> generated_ids = model.generate(**inputs, max_new_tokens=6, bad_words_ids=bad_words_ids)
>>> generated_text = processor.batch_decode(generated_ids, skip_special_tokens=True)
>>> print(generated_text[0])
Instruction: Classify the following image into a single category from the following list: ['animals', 'vegetables', 'city landscape', 'cars', 'office'].
Category: Vegetables
```

ูู ุงููุซุงู ุฃุนูุงูุ ููุฌู ุงููููุฐุฌ ูุชุตููู ุงูุตูุฑุฉ ุฅูู ูุฆุฉ ูุงุญุฏุฉุ ูููู ููููู ุฃูุถูุง ุชูุฌูู ุงููููุฐุฌ ููููุงู ุจุชุตููู ูุฑุชุจ.

## ุชูููุฏ ุงููุต ุงูููุฌู ุจุงูุตูุฑ

ููุชุทุจููุงุช ุงูุฃูุซุฑ ุฅุจุฏุงุนูุงุ ููููู ุงุณุชุฎุฏุงู ุชูููุฏ ุงููุต ุงูููุฌู ุจุงูุตูุฑ ูุฅูุดุงุก ูุต ุจูุงุกู ุนูู ุตูุฑุฉ. ูููู ุฃู ูููู ูุฐุง ูููุฏูุง ูุฎูู ุฃูุตุงู ููููุชุฌุงุชุ ูุงูุฅุนูุงูุงุชุ ูุฃูุตุงู ุงููุดุงูุฏุ ููุง ุฅูู ุฐูู.

ุฏุนูุง ููุฌู IDEFICS ููุชุงุจุฉ ูุตุฉ ุจูุงุกู ุนูู ุตูุฑุฉ ุจุณูุทุฉ ูุจุงุจ ุฃุญูุฑ:

<div class="flex justify-center">
     <img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/tasks/idefics-story-generation.jpg" alt="ุตูุฑุฉ ูุจุงุจ ุฃุญูุฑ ูุน ููุทูู ุนูู ุงูุฏุฑุฌุงุช"/>
</div>

ุงูุตูุฑุฉ ูู [Craig Tidball](https://unsplash.com/@devonshiremedia).

```py
>>> prompt = ["Instruction: Use the image to write a story. \n",
...     "https://images.unsplash.com/photo-1517086822157-2b0358e7684a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2203&q=80",
...     "Story: \n"]

>>> inputs = processor(prompt, return_tensors="pt").to("cuda")
>>> bad_words_ids = processor.tokenizer(["<image>", "<fake_token_around_image>"], add_special_tokens=False).input_ids

>>> generated_ids = model.generate(**inputs, num_beams=2, max_new_tokens=200, bad_words_ids=bad_words_ids)
>>> generated_text = processor.batch_decode(generated_ids, skip_special_tokens=True)
>>> print(generated_text[0]) 
Instruction: Use the image to write a story. 
 Story: 
Once upon a time, there was a little girl who lived in a house with a red door.  She loved her red door.  It was the prettiest door in the whole world.

One day, the little girl was playing in her yard when she noticed a man standing on her doorstep.  He was wearing a long black coat and a top hat.

The little girl ran inside and told her mother about the man.

Her mother said, โDonโt worry, honey.  Heโs just a friendly ghost.โ

The little girl wasnโt sure if she believed her mother, but she went outside anyway.

When she got to the door, the man was gone.

The next day, the little girl was playing in her yard again when she noticed the man standing on her doorstep.

He was wearing a long black coat and a top hat.

The little girl ran
```

ูุจุฏู ุฃู IDEFICS ูุงุญุธ ุงูููุทูู ุนูู ุนุชุจุฉ ุงูุจุงุจ ูุงุฎุชุงุฑ ูุตุฉ ูุฎููุฉ ุนู ุดุจุญ.

<Tip>

ุจุงููุณุจุฉ ููููุงุชุฌ ุงูุฃุทูู ูุซู ูุฐูุ ุณุชุณุชููุฏ ุจุดูู ูุจูุฑ ูู ุถุจุท ุงุณุชุฑุงุชูุฌูุฉ ุชูููุฏ ุงููุต. ูููู ุฃู ูุณุงุนุฏู ูุฐุง ูู 
ุชุญุณูู ุฌูุฏุฉ ุงููุต ุงููููุฏ ุจุดูู ูุจูุฑ. ุงุทูุน ุนูู [ุงุณุชุฑุงุชูุฌูุงุช ุชูููุฏ ุงููุต](../generation_strategies) 
ููุนุฑูุฉ ุงููุฒูุฏ.
</Tip>

## ุชุดุบูู ุงูุงุณุชุฏูุงู ูู ูุถุน ุงูุฏูุนุงุช

ุฃูุถุญุช ุฌููุน ุงูุฃูุณุงู ุงูุณุงุจูุฉ IDEFICS ููุซุงู ูุงุญุฏ. ุจุทุฑููุฉ ูุดุงุจูุฉ ุฌุฏูุงุ ููููู ุชุดุบูู ุงูุงุณุชุฏูุงู 
ููุฌููุนุฉ ูู ุงูุฃูุซูุฉ ุนู ุทุฑูู ุชูุฑูุฑ ูุงุฆูุฉ ูู ุงููุทุงูุจุงุช:

```py
>>> prompts = [
...     [   "https://images.unsplash.com/photo-1543349689-9a4d426bee8e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=3501&q=80",
...         "This is an image of ",
...     ],
...     [   "https://images.unsplash.com/photo-1623944889288-cd147dbb517c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=3540&q=80",
...         "This is an image of ",
...     ],
...     [   "https://images.unsplash.com/photo-1471193945509-9ad0617afabf?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=3540&q=80",
...         "This is an image of ",
...     ],
... ]

>>> inputs = processor(prompts, return_tensors="pt").to("cuda")
>>> bad_words_ids = processor.tokenizer(["<image>", "<fake_token_around_image>"], add_special_tokens=False).input_ids

>>> generated_ids = model.generate(**inputs, max_new_tokens=10, bad_words_ids=bad_words_ids)
>>> generated_text = processor.batch_decode(generated_ids, skip_special_tokens=True)
>>> for i,t in enumerate(generated_text):
...     print(f"{i}:\n{t}\n") 
0:
This is an image of the Eiffel Tower in Paris, France.

1:
This is an image of a couple on a picnic blanket.

2:
This is an image of a vegetable stand.
```

## IDEFICS ูููุญุงุฏุซุงุช

ุจุงููุณุจุฉ ูุญุงูุงุช ุงูุงุณุชุฎุฏุงู ุงููุญุงุฏุซูุฉุ ููููู ุงูุนุซูุฑ ุนูู ุฅุตุฏุงุฑุงุช ูุฏุฑุจุฉ ูู ุงููููุฐุฌ ุนูู ๐ค Hub: 
`HuggingFaceM4/idefics-80b-instruct` ู `HuggingFaceM4/idefics-9b-instruct`.

ูุฐู ุงูููุงุท ุงููุฑุฌุนูุฉ ูู ูุชูุฌุฉ ูุชุฏุฑูุจ ุงูููุงุฐุฌ ุงูุฃุณุงุณูุฉ ุนูู ูุฒูุฌ ูู ูุฌููุนุงุช ุงูุจูุงูุงุช ุงูููุดุฑูุฉ ูุงูุชุฏุฑูุจ ุนูู ุงูุชุนูููุงุชุ 
ูุงูุฐู ูุนุฒุฒ ุงูุฃุฏุงุก ูู ุงูุฃุณูู ุจูููุง ูุฌุนู ุงูููุงุฐุฌ ุฃูุซุฑ ูุงุจููุฉ ููุงุณุชุฎุฏุงู ูู ุงูุฅุนุฏุงุฏุงุช ุงููุญุงุฏุซูุฉ.

ุงูุงุณุชุฎุฏุงู ูุงูุชูุฌูู ููุงุณุชุฎุฏุงู ุงููุญุงุฏุซู ูุดุงุจู ุฌุฏูุง ูุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ุงูุฃุณุงุณูุฉ:

```py
>>> import torch
>>> from transformers import IdeficsForVisionText2Text, AutoProcessor
>>> from accelerate.test_utils.testing import get_backend

>>> device, _, _ = get_backend() # ุชููุงุฆููุง ููุชุดู ููุน ุงูุฌูุงุฒ ุงูุฃุณุงุณู (CUDAุ CPUุ XPUุ MPSุ ุฅูุฎ)
>>> checkpoint = "HuggingFaceM4/idefics-9b-instruct"
>>> model = IdeficsForVisionText2Text.from_pretrained(checkpoint, torch_dtype=torch.bfloat16).to(device)
>>> processor = AutoProcessor.from_pretrained(checkpoint)

>>> prompts = [
...     [
...         "User: What is in this image?",
...         "https://upload.wikimedia.org/wikipedia/commons/8/86/Id%C3%A9fix.JPG",
...         "<end_of_utterance>",

...         "\nAssistant: This picture depicts Idefix, the dog of Obelix in Asterix and Obelix. Idefix is running on the ground.<end_of_utterance>",

...         "\nUser:",
...         "https://static.wikia.nocookie.net/asterix/images/2/25/R22b.gif/revision/latest?cb=20110815073052",
...         "And who is that?<end_of_utterance>",

...         "\nAssistant:",
...     ],
... ]

>>> # --ูุถุน ุงูุฏูุนุงุช
>>> inputs = processor(prompts, add_end_of_utterance_token=False, return_tensors="pt").to(device)
>>> # --ูุถุน ุงูุนููุฉ ุงููุงุญุฏุฉ
>>> # inputs = processor(prompts[0], return_tensors="pt").to(device)

>>> # ูุนููุงุช ุงูุชูููุฏ
>>> exit_condition = processor.tokenizer("<end_of_utterance>", add_special_tokens=False).input_ids
>>> bad_words_ids = processor.tokenizer(["<image>", "<fake_token_around_image>"], add_special_tokens=False).input_ids

>>> generated_ids = model.generate(**inputs, eos_token_id=exit_condition, bad_words_ids=bad_words_ids, max_length=100)
>>> generated_text = processor.batch_decode(generated_ids, skip_special_tokens=True)
>>> for i, t in enumerate(generated_text):
...     print(f"{i}:\n{t}\n")
```
```